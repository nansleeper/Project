(self.webpackChunkvk=self.webpackChunkvk||[]).push([[56058],{337057:(e,t,n)=>{"use strict";n.d(t,{VkIndexer:()=>a});var a=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},a=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),r=a.length;r--;){var o=a[r],i="";if(o){for(var s=0;s<6;s++){var l=o.charCodeAt(s);if(l){var c=this.toTranslit[l],u=o.substr(s,1);i+=null!=c?c:u}}n[i]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var r={},o=n[a],i="",s="",l="",c=o.length>1;if(o){for(var u=0;u<6;u++){var d=o.charCodeAt(u);if(d){var h=this.toTranslit[d],m=o.substr(u,1);if(i+=null!=h?h:m,c){var g=this.toLocalCase[m],p=this.toLocalTranslit[d];s+=null!=g?g:m,l+=null!=p?p:m}}}r[i]=1,c&&(r[s]=2,r[l]=3),t.push(r)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var r=e.substr(a,1)||-1;n=n[r]?n[r]:n[r]=5==a?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var r=this.index,o=0;o<6;o++){var i=a.substr(o,1)||-1;if(!r[i])break;r=r[i]}if(r.length)for(var o in r)if(this.equals(r[o],e)){r.splice(o,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(r(e[0])||r(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var a=e.shift();a&&n.push(a)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],r=!1;for(var o in n)if(n.hasOwnProperty(o)){if(r&&!a)break;var i=this.localSearch(n[o],0,t);i.sort((function(e,t){return e._order-t._order})),a=r?this.intersect(a,i):i,r=!0}for(var s=a[0],l=a.length+1,c=[],u=1;u<l;u++){var d=a[u];d!=s&&(c.push(s),s=d)}return c},e.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var r in e)e.hasOwnProperty(r)&&(a[i=r.substr(t,1)||-1]||(a[i]={}),a[i][r]=1);if(6==t++)return n;var o=[];for(var i in a)if("-1"===i)for(var s in n)n.hasOwnProperty(s)&&o.push.apply(o,this.localSearch(a[i],t,n[s]));else{var l=this.localSearch(a[i],t,n[i]);o.push.apply(o,l)}return o},e}();function r(e){return!isNaN(e)}},125396:(e,t,n)=>{"use strict";n.d(t,{default:()=>g});var a=n(667294),r=n(887854),o=n.n(r),i=n(408091),s=n(634777),l=n(379333),c="0 0 24 24",u="settings_24",d=!1;function h(){d||((0,s.addSpriteSymbol)(new(o())({id:u,viewBox:c,content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="settings_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path d="M9.127 5.052c1.256-.72 1.473-1.469 1.623-2.219.167-.833.417-.833.833-.833h.834c.416 0 .583 0 .833.833.225.751.383 1.502 1.631 2.223 1.397.379 2.08.002 2.717-.422.707-.471.884-.294 1.178 0l.59.59c.294.294.412.412 0 1.178-.372.69-.791 1.333-.418 2.725.72 1.256 1.469 1.473 2.219 1.623.833.167.833.417.833.833v.834c0 .416 0 .583-.833.833-.751.225-1.502.383-2.223 1.631-.379 1.397-.002 2.08.422 2.717.471.707.294.884 0 1.178l-.59.59c-.294.294-.412.412-1.178 0-.69-.372-1.333-.791-2.725-.418-1.256.72-1.473 1.469-1.623 2.219-.167.833-.417.833-.833.833h-.834c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.631-2.223-1.397-.379-2.08-.002-2.717.422-.707.471-.884.294-1.178 0l-.59-.59c-.294-.294-.412-.412 0-1.178.372-.69.791-1.333.418-2.725-.72-1.256-1.469-1.473-2.219-1.623C2 13.083 2 12.833 2 12.417v-.834c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.223-1.631.379-1.397.002-2.08-.422-2.717-.471-.707-.294-.884 0-1.178l.59-.59c.294-.294.412-.412 1.178 0 .69.372 1.333.791 2.725.418zM12 16.75a4.75 4.75 0 100-9.5 4.75 4.75 0 000 9.5z" fill="currentColor" /></g></symbol>'})),d=!0)}var m=function(e){return(0,s.useIsomorphicLayoutEffect)((function(){h()}),[]),a.createElement(l.SvgIcon,(0,i.assign)({},e,{viewBox:c,id:u,width:isNaN(e.width)?24:+e.width,height:isNaN(e.height)?24:+e.height}))};m.mountIcon=h;const g=m},649159:(e,t,n)=>{"use strict";n.d(t,{MessageForward:()=>w});n(175115),n(530522),n(66108),n(991181),n(579665),n(95767),n(820075),n(940851),n(296253);var a=n(667294),r=(n(45697),n(319368)),o=n(148434),i=n(166056),s=n(389430),l=n(227192),c=n(663527),u=n(929566),d=n(351117),h=n(81020),m=n(41437),g=n(393202),p=n(121265),v=n(283778),f=n(800234),_=n(791563),C=n(432975);function b(){return(b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function I(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){r=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var S=(0,l.debouncedPromise)(s.searchHints,300),y=m.default.getLang;class T extends a.Component{constructor(e){var t;super(e),t=this,this.toggleMode=()=>{var e=this.props.store;if((0,u.isCommunityInterface)(e)){var t=0===this.state.mode?1:0,n=0===t?s.searchImTopConv:s.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},(()=>n("",e.get()).then((e=>this.setSearchResults(this.filterResults(e)))).then((()=>this.searchInput.focus())).catch((e=>console.error(e)))))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});var t=e.target.value;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{var t=(0,u.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter((e=>{var n=e.peerId;return!(t&&n<0)&&(!(t&&n>2e9&&!(0,d.doesChatTabHaveFlag)(e,1024))&&!(!t&&n>2e9&&(0,d.doesChatTabHaveFlag)(e,1024)))}))},this.onSearch=e=>{var t=this.props.store,n=t.get(),a=(0,u.isCommunityInterface)(t)&&0===this.state.mode,r=a?s.searchImTopConv:s.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})):r(e,n).then((t=>{var r=t.map((e=>e.peerId));return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?S(e,r,"all",{hidegid:a,skipStoreUpdate:a},n):Promise.resolve([])})).then((t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)})).catch((()=>{}))},this.emptySearch=()=>{var e=this.props.store,t=e.get(),n=t.dialog_tabs.all,a={},r={};return(0,s.searchTopConv)("",t).then((o=>(o.forEach((e=>{r[e.peerId]=e})),[t.peer].concat(n.filter((e=>e!==t.peer))).map((t=>{var n=(0,u.getTab)(e,t);return a[t]=!0,{name:r[t]&&r[t].tab||n.tab,photo:r[t]&&r[t].photo||n.photo,lastmsg:n.lastmsg,major_sort_id:n.major_sort_id,minor_sort_id:n.minor_sort_id,data:n.data,peerId:t}})).concat(o.filter((e=>!a[e.peerId]))).sort(((n,a)=>n.peerId===t.peer?-1:a.peerId===t.peer?1:(0,C.sortFn)(e,n,a))))))},this.sendRecipient=e=>{var t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll.push([(0,h.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),(0,g.statlogsForwardEvent)(t),(0,u.isCommunityInterface)(t)&&(0,g.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},(()=>{Emoji.focus(this.input)}))},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=function(e,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t.unmounted)if(n){var r=e.filter((e=>!t.found[e.peerId]));r.forEach((e=>{t.found[e.peerId]=!0})),t.setState({found:[].concat(t.state.found,r),loading:a})}else t.found=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),t.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),Emoji.hide(this.emojiButton,e)},this.send=()=>{var e=this.props.store,t=this.state.selected,n=Emoji.val(this.input).trim(),a=new v.ImDraft({},0),r=e.get().pendingForward;if(t&&!(0,c.isMessageTooLong)(val)){this.setState({sending:!0});var o=(0,u.isCommunityInterface)(e)&&0===this.state.mode;o||a.addAttach("mail",r.msgIds.join(";"),r.object||null);var i={message:n,attaches:a.dData.attaches.map((e=>[e.type,e.id]))||[]},l={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:o?r.msgIds.join(";"):void 0}};new Promise((n=>{(0,s.loadHashes)([t],{hidegid:!0},e.get()).then((e=>{var a=I(e,1)[0];return n(a[t])}))})).then((n=>e.set(s.sendMessage.bind(null,t,i,b({hash:n},l))))).then((()=>{(0,g.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),showDoneBox(y("mail_send3"))})).catch((e=>{this.unmounted||this.setState({sending:!1},(()=>{(0,_.showFastBox)(y("mail_error"),e)}))}))}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})).catch((e=>console.error(e)))}componentDidMount(){this.props.updatePopup(),Emoji.init(this.input,{noStickers:!0,onSend:this.send}),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){var e=this.props,t=e.store,n=e.closePopup,s=this.state,l=s.mode,c=s.loading,d=s.selected,h=s.found,m=s.sending,g=(0,p.classNames)("MessageForward",{"MessageForward--form":0===l&&!!d});return a.createElement("section",{className:g},a.createElement(r.default,{title:a.createElement(a.Fragment,null,a.createElement("span",{className:"MessageForward__title"},y("mail_forward_messages")),(0,u.isCommunityInterface)(t)&&a.createElement("span",{className:"MessageForward__switch",onClick:this.toggleMode},y(0===l?"mail_forward_to_community_messages":"mail_forward_to_im"))),onCloseClick:n}),a.createElement("div",{className:"MessageForward__content"},a.createElement(i.ConvoPicker,{searchValue:this.state.value,isLoading:c,convos:h.map((e=>e||(0,u.getTab)(t,e.peerId))),mode:1===l?i.convoPickerMode.DEFAULT:i.convoPickerMode.RADIO,selectedConvos:[d],onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),a.createElement("footer",{className:"MessageForward__footer",ref:this.getFormRef,key:"footer"},a.createElement("div",{className:"MessageForward__form _emoji_field_wrap"},a.createElement("div",{className:"MessageForward__input",tabIndex:"0",contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:y("mail_im_enter_msg")}),a.createElement("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap"},a.createElement("div",{ref:this.getEmojiButtonRef,className:"emoji_smile _emoji_btn",title:y("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,onClick:this.onEmojiButtonClick},a.createElement("div",{className:"emoji_smile_icon_vector emoji_smile_icon"})))),m?a.createElement("div",{className:"MessageForward__send-spinner"},a.createElement(o.default,null)):a.createElement("button",{className:"MessageForward__send",onClick:this.send}))))}}var w=(0,f.connect)(T)},888563:(e,t,n)=>{"use strict";n.d(t,{checkContactListLoaded:()=>F,mount:()=>X});n(820075),n(991181),n(59357),n(940851),n(296253);var a=n(719016),r=n(116886),o=n(533246),i=n(389430),s=n(663527),l=n(172989),c=n(81020),u=n(929566),d=n(121265),h=n(193483),m=n(135685),g=n(992828),p=n(212311),v=n(632910),f=n(595869),_=n(486353),C=n(351117),b=n(236205),I=n(414914),E=n(442699),S=n(261808),y="_im_dialog_action_wrapper",T="_im_dialog_call_action_wrapper",w="_im_header_icon",k="_im_page_action",A="_im_chat_verified",L="._im_page_status",M="im-page--chat-header_reconnected",P="button_disabled",N="im-page--header-action_loading";function R(e,t,n){return!e.map((e=>{var a=(0,u.getMessage)(t,n,e);return a&&(0,h.isImportant)(a)})).reduce(((e,t)=>e&&t),!0)}function B(e,t){var n=t.get(),a=n.peer,r=n.tabs[a].pinned;return 1===e.length&&r&&e[0]===(0,u.parserMessage)(r).messageId}function F(e){return e.get().contactsList?Promise.resolve(e):e.set(i.getContactsList)}function O(e,t,n){var a=(0,r.getLang)("mail_selected_shorted",t.length);H({actions:!0},"im-page--chat-header"),(0,I.val)((0,I.geByClass1)("im-page--selected-messages"),(0,E.getTemplate)("im_selected_messages",{label:a.replace("{count}",t.length),tip:(0,r.getLang)("mail_deselect_all")}));var o=(0,u.getTab)(n,n.get().peer),i=t.some((e=>{var t=(0,u.getMessage)(n,n.get().peer,e);if(!t)return!1;var a=t.attaches[0];return!(!a||"widget"!==a.type)})),l=e.querySelector("._im_mess_actions"),c=R(t,n,n.get().peer),h=B(t,n),m=t.length>1,g=!m&&(0,s.isChatPeer)(o.peerId)&&(0,s.canPinMessage)(n,t[0]),p=(0,s.canForwardMessages)(n,t)&&!i,v=e.querySelector('._im_page_action[data-action="respond"]'),f=e.querySelector('._im_page_action[data-action="forward"]'),_=Boolean((0,u.tabIsOutgoingMessageRequest)(o)),b=Boolean((0,u.tabIsMessageRequest)(o)),S=(0,C.isBusinessNotifyPeer)(n,n.get().peer);l.className=(0,d.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!c&&!i,"im-page--mess-actions_pinned":h,"im-page--mess-actions_channel":(0,u.isChannelPeer)(o)&&!n.get().gid,"im-page--mess-actions_multiple-selection":m,"im-page--mess-actions_no-pin-btn":!g,"im-page--mess-actions_out-mr":_,"im-page--mess-actions_in-mr":b,"im-page--mess-actions_business-notify":S,"im-page--mess-actions_no-important-btn":!(0,s.canMarkImportant)(n,t)||i}),t.length>1?v.innerHTML=(0,r.getLang)("mail_forward_here"):v.innerHTML=(0,r.getLang)("mail_im_mark_reply"),p?(f.removeAttribute("disabled"),f.classList.remove(P)):(f.setAttribute("disabled","disabled"),f.classList.add(P)),m&&!p||(0,C.isBusinessNotifyTab)(o)||i?(v.setAttribute("disabled","disabled"),v.classList.add(P)):(v.removeAttribute("disabled"),v.classList.remove(P));var y=c?(0,r.getLang)("mail_im_toggle_important"):(0,r.getLang)("mail_im_toggle_important_off"),T=h?(0,r.getLang)("mail_unpin"):(0,r.getLang)("mail_pin");attr((0,I.geByClass1)("im-page-action_star",e),"aria-label",y),attr((0,I.geByClass1)("im-page-action_pin",e),"aria-label",T)}function D(e,t,n){var a=t.get(),r=a.peer,o=a.tabs[r],l=(0,I.geByClass1)(A,e),c=(0,I.geByClass1)(s.PINNED_CONTAINER_CLASS,e),d=(0,s.isChatPeer)(r),h=d&&(0,u.isChannelPeer)(o),p=d&&(0,C.isBusinessNotifyTab)(o)&&(0,b.isBusinessNotifyEnabled)(t),v=a.selectedMessages&&!!a.selectedMessages.length;l.tt=!1;var f=(0,s.renderPhotosFromTab)(t,o,!1),_=(0,E.getTemplate)("im_simple_link",{href:h?"/club"+-o.ownerId:o.href,content:(0,E.getTemplate)("im_peer_photo",{online_class:"",owner_photo:f,modifier_class:"nim-peer_smaller"})});(0,I.val)((0,I.geByClass1)("im-page--aside-photo",e),_);var S=d&&(0,u.isChatActive)(o),y={muted:inArray(r,a.mutedPeers),verified:!!o.verified,chat:d,vkcomgroup:h,actions:v,derelict:d&&!S&&!h&&!p,pinned:!1};if(d){var T=(0,u.getPinnedMessage)(t),k=function(e){var t=(0,u.getPinnedMessage)(e);if(!t||(0,m.oCacheGet)(e,t.userId))return!1;return t.userId}(t);T&&(0,g.isPinnedMessageVisibleInTab)(t,r)&&(k?t.set(i.loadChatMember.bind(null,{[r]:[k]})).then(D.bind(null,e,t,n)):y.pinned=!0)}x(t,o,e);var L=!o.top_banner&&c.innerHTML,M=!o.top_banner&&U(t,e,c),P=(0,I.geByClass1)("_im_page_peer_name",e);(0,I.removeClass)(P,s.DESELECT_ALL_CLASS),function(e,t,n){var a=n.length>0;(0,I.geByClass)(w,e).forEach((e=>{if("star"===e.dataset.type&&(0,s.isFoldersAvailable)(t)&&((0,I.toggleClass)(e,"im-page--header-icon_shown",!a),(0,I.toggleClass)(e,"im-page--header-icon_star-active",(0,s.isImportant)(t))),"answer"===e.dataset.type&&(0,s.isFoldersAvailable)(t)&&(0,I.toggleClass)(e,"im-page--header-icon_shown",!a&&(0,s.isUnrespond)(t)),"search"===e.dataset.type&&!(0,s.isCommunityInterface)(t)){var n=t.get().peer,r=!a&&(0,s.isFullyLoadedTab)(t,n)&&(0,u.getTab)(t,n).offset&&!(0,s.isCommunityInterface)(t)&&(!(0,s.isCallToPeerAvailable)(t,n)||!(0,s.isClassicInterface)(t));(0,I.toggleClass)(e,"im-page--header-icon_shown",r)}}))}(e,t,[]);var N=e.querySelector("._im_dialog_call_action_wrapper"),R=e.querySelector("._im_header_icon[data-type=call]");if(N&&N.classList.toggle("im-page--header-call-is-hidden",!(0,s.isCallToPeerAvailable)(t,r)||!!o.callInProgress),R&&(R.classList.toggle("im-page--header-icon_shown",(0,s.isCallToPeerAvailable)(t,r)&&!!o.callInProgress),R.classList.toggle("im-page--header-icon_call-active",!!o.callInProgress&&o.callInProgress.participants.count>0)),(0,s.isClassicInterface)(t)){var B=(0,I.geByClass1)("_im_page_back",e);attr(B,"href",`${(0,s.getBaseLink)(t)}?tab=${a.active_tab}`)}H(y,"im-page--chat-header"),(0,s.compensateHistoryHeightChange)(t,M,L,n)}function x(e,t,n){var a=(0,s.isChatPeer)(t.peerId),o=a&&(0,u.isChannelPeer)(t),i=a&&(0,u.isChatActive)(t),l=a&&(0,u.isCasperChatTab)(t),c=a&&(0,C.isBusinessNotifyTab)(t)&&(0,b.isBusinessNotifyEnabled)(e),d=(0,s.isContactPeer)(t.peerId),h=t.isDonutChat,m="";a?m=o?(0,E.getTemplate)("im_vkcomgroup_members",{name:(0,r.getLang)("mail_im_n_vkcomgroup_members",(0,s.getAliveMembersCount)(t))}):i?(0,E.getTemplate)("im_chat_members",{name:(0,r.getLang)("mail_im_n_chat_members",(0,s.getAliveMembersCount)(t))}):"":(0,s.isUserPeer)(t.peerId)&&(m=(0,s.getLastSeenTextInHeader)(e,t.peerId));var g=[];""!==m||c||g.push("im-page--title--1line"),l&&g.push("im-page--title--casper"),h&&g.push("im-page--title--donut"),c&&g.push("im-page--title--business-notify"),g=g.join(" ");var p=d?(0,s.prepareContactName)(t.name):t.tab,v=(0,E.getTemplate)("im_simple_name",{name:p,href:o?"/club"+-t.ownerId:t.href,name_attr:stripHTML(p),ads_union:t.ad_union_ids_attr,online:m,more_cls:g,more_children:c?(0,E.getTemplate)("sImSimpleNameBusinessNotifyLabel",{text:(0,r.getLang)("mail_tab_business_notify")}):""});(0,I.val)((0,I.geByClass1)("im-page--title-wrapper",n),v)}function U(e,t,n){var a=(0,u.getPinnedMessage)(e),r=n||(0,I.geByClass1)(s.PINNED_CONTAINER_CLASS,t);if((0,I.removeClass)(r,"im-page--pinned_with-bar"),a&&(0,h.isMoneyRequest)(a)){if(void 0===a.kludges.attach1_tr_amount)return;a.kludges.attach1_total_amount&&(0,I.addClass)(r,"im-page--pinned_with-bar")}var o=(0,s.renderPinnedMessage)(e);return(0,I.val)(r,o),!!o}function H(e,t){var n=(0,I.geByClass1)(t);Object.keys(e).forEach((a=>{(0,I.toggleClass)(n,`${t}_${a}`,!!e[a])}))}function j(e,t,n,a,r){e.set(i.removeMessagesWithRestore.bind(null,n,r,a)).then(t().removeMessagesRestore.bind(null,n,r,a)),(0,i.removeMessageSend)(n,r,null,a,e.get()).then((()=>{var a=(0,u.getTab)(e,r);n.includes(a.lastmsg)&&(0,i.loadActualLastMessage)(e,r).then((()=>{(0,_.partConfigEnabled)("messenger_empty_pinned_support")&&t().updateConvoInList(r,e),t().updateState(r,e)}))}))}function q(e,t,n,a,r){var o=e.get().selectedMessages,c=domData(r,"action"),d=e.get().peer,h=(0,u.getTab)(e,d),m=!0;if(!["star","delete"].includes(c)&&(0,u.tabIsOutgoingMessageRequest)(h))return V(e,t,n);switch(c){case"delete":var g=!(vk.id==d&&!e.get().gid)&&o.every((t=>(0,s.canMessageBeDeletedForAll)(e,(0,u.getMessage)(e,d,t))));if(g||o.length>1){m=!1;var p=(0,s.showMsgDeleteDialog)(d,o.length,g,(a=>{V(e,t,n),p.hide(),cur.imDb.updateByKey("del_forall_checked",a),a?(0,i.removeMessageSend)(o,d,null,"deleteforall",e.get()):j(e,t,o,c,d)}))}else j(e,t,o,c,d);break;case"spam":j(e,t,o,c,d);break;case"forward":if(!(0,s.canForwardMessages)(e,o))return;(0,i.processFwd)(o,d,e).then((t=>e.set(i.prepareForward.bind(null,t)))).then((()=>n().showForward(e))).catch((e=>console.error(e)));break;case"star":var v=R(o,e,d);e.set(i.favMessage.bind(null,o,v,d)),e.get().longpoll.push(o.map((e=>({type:v?l.SET_FLAGS:l.RESET_FLAGS,messageId:e,peerId:d,flags:l.FLAG_IMPORTANT}))));break;case"respond":var f=e.get(),_=1===o.length;(0,i.processFwd)(o,f.peer,e).then((t=>e.set(i.forwardMessages.bind(null,t,f.tfdraft,_)))).then((()=>{t().respond(e,d)}));break;case"pin":var C=(0,u.getLocalId)(e,o[0]);if(!(0,s.canPinMessage)(e,C))return;var b=B(o,e),I=b?i.unpinMessageOptimistic.bind(null,d):i.pinMessageOptimistic.bind(null,C,d),E=b?i.unpinMessage.bind(null,d):i.pinMessage.bind(null,C,d),S=Q.bind(null,t,d);e.set(i.checkChatMember.bind(null,e,C,d)).then((e=>e.set(I))).then(S).then((e=>e.set(E))).then(S)}m&&V(e,t,n)}function G(e,t,n,a,r,o){var i=domData(o,"action"),s=a.querySelector(`.${y} ._ui_menu`).parentNode,l=e.get().peer;(0,S.handleUiActionForPeer)(e,t,n,i,l),uiActionsMenu.toggle(s,!1),t().cancelEditing()}function V(e,t,n){var a=e.get().selectedMessages;e.set(i.cleanSelected).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,a))}function K(e,t,n,o){var i,l,c=(0,s.isClassicInterface)(e);switch(domData(o,"type")){case"star":l=[4,6],i=()=>(0,s.isImportant)(e)?(0,r.getLang)("mail_im_toggle_important_off"):(0,r.getLang)("mail_im_toggle_important");break;case"answer":l=[4,6],i=(0,r.getLang)("mail_end_conversation");break;case"search":l=c?[5,6]:[4,-9],i=(0,r.getLang)("mail_search_in_peer")}(0,a.showTooltip)(o,{text:i||"",black:1,shift:l,forcetoup:!0,appendParentCls:c?"_im_dialog_actions":"_im_mess_actions"})}function z(e,t,n){var r=(0,s.isClassicInterface)(e),o=domData(n.target,"action");"respond"!==o&&"forward"!==o&&(0,a.showTooltip)(n.target,{text:W.bind(null,e,o)||"",black:1,shift:[2,r?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function W(e,t){var n=e.get(),a=n.selectedMessages,o=n.peer;switch(t){case"pin":return B(a,e)?(0,r.getLang)("mail_unpin"):(0,r.getLang)("mail_pin");case"star":return R(a,e,o)?(0,r.getLang)("mail_im_toggle_important"):(0,r.getLang)("mail_im_toggle_important_off");case"delete":return(0,r.getLang)("mail_delete");case"spam":return(0,r.getLang)("mail_im_mark_spam")}}function Y(e,t,n,a,o){var l=domData(o,"type"),d=e.get().peer;switch(l){case"star":e.set(i.toggleDialogImportant.bind(null,d)).then((()=>{setTimeout((()=>K(e,0,0,o)),40)}));break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(o,{fasthide:!0});break;case"answer":var h=(0,u.getTab)(e,d);h&&(e.set(i.markDialogAnswered.bind(null,e.get().peer,h.lastmsg)),showDoneBox((0,r.getLang)("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([(0,c.resetPeer)()]));break;case"call":if((0,s.isCallToPeerAvailable)(e,d)){var m=(0,u.getTab)(e,d).callInProgress;m&&(0,s.joinCallFromIm)(e,d,m.join_link,!1,s.CALL_ENTRY_POINT_JOIN_HEADER)}}}function $(e,t){var n=Number(t),a=(0,s.formatTimespan)(n,!0),o=(0,r.getLang)("mail_network_waiting").replace(/{timer}/gi,a);e.querySelector(L).innerHTML=o}function Q(e,t,n){return e().updateChatTopic(t,n),n}function J(e,t,n,a){var l={};return{changeActions(t){var n=e.querySelector(`.${y} ._ui_menu`),a=e.querySelector(`.${y}`),r=t.get().curActions||{},o=Object.keys(r).sort(((e,t)=>i.ACTION_PRIORITIES[e]-i.ACTION_PRIORITIES[t]));if(0!==o.length){for(var s=(0,E.getTemplate)("sUiActionsMenuSeparator"),l="",c=0,u=0;u<o.length;u++){var d=o[u];u>0&&(c/10|0)!=(i.ACTION_PRIORITIES[d]/10|0)&&(l+=s),l+=(0,E.getTemplate)("sImUiActionMenuItem",{action:d,name:r[d].name,icon:r[d].icon,classes:"_im_action"}),c=i.ACTION_PRIORITIES[d]}n.innerHTML=l,a.classList.remove(N)}else a.classList.add(N)},setNetworkWaitingStatus(t,n){l.interval&&clearInterval(l.interval);var a=(0,u.getTab)(n,(0,C.getCurrentTab)(n));a&&!(0,C.isBusinessNotifyTab)(a)&&($(e,t),l.timeout=t,l.interval=setInterval((()=>{l.timeout>1?(l.timeout--,$(e,l.timeout)):(clearInterval(l.interval),l={})}),1e3))},setNetworkReconnectingStatus(t){l.interval&&clearInterval(l.interval),l={};var n,a,o=(0,u.getTab)(t,(0,C.getCurrentTab)(t));o&&!(0,C.isBusinessNotifyTab)(o)&&(n=e.querySelector(L),a=(0,r.getLang)("mail_network_reconnecting"),n&&(n.innerHTML=a))},clearNetworkStatus(){l.interval&&clearInterval(l.interval),l={},e.querySelector(L).innerHTML=""},showSettings(t){var n=t.get(),r=(0,u.getTab)(t,n.peer);(0,u.isChatActive)(r)&&(0,p.mount)(e,t,a)},showForward(t){(0,v.mount)(e,t,a)},renderPeer(n){D(e,n,t)},reRenderPinned(t){var n=(0,C.getCurrentTab)(t);n&&n.pinned&&U(t,e)},reRenderTitle(t){var n=(0,C.getCurrentTab)(t);n&&x(t,n,e)},renderActions(t){var n=t.get().selectedMessages||[];n.length>0&&O(e,n,t)},hideActions(t){if(!(0,s.isFullyLoadedTab)(t,t.get().peer)){(0,I.geByClass)(w,e).forEach((e=>{(0,I.addClass)(e,N)}));var n=(0,I.geByClass1)(y,e);(0,I.addClass)(n,N);var a=(0,I.geByClass1)(T,e);(0,I.addClass)(a,N)}},showActions(t){if((0,s.isFullyLoadedTab)(t,t.get().peer)){(0,I.geByClass)(w,e).forEach((e=>{(0,I.removeClass)(e,N)}));var n=(0,I.geByClass1)(y,e);(0,I.removeClass)(n,N);var a=(0,I.geByClass1)(T,e);(0,I.removeClass)(a,N)}},changedMessageSelection(n){if(0!==n.get().peer){var a=n.get().selectedMessages||[];a.length>0?O(e,a,n):D(e,n,t)}},updateLastSeen(t){!function(e,t){var n=e.get().peer,a=(0,I.geByClass1)("_im_page_peer_online",t);a&&(0,s.isUserPeer)(n)&&(0,u.getTab)(e,n)&&(0,s.applyInnerHtml)(a,(0,s.getLastSeenTextInHeader)(e,n))}(t,e)},deselectAll(e){V(e,t,a)},updateState(e){t().updateState.bind(null,e)},unmount(){(0,o.destroyModule)(n),cancelStackFilter("fowrward")}}}function X(e,t,n){var a=(0,o.createMutations)(J),r=a.callMutations,l=a.bindMutations,d=q.bind(null,t,n,r),h=G.bind(null,t,n,r,e),m=V.bind(null,t,n,r),g=(e,n)=>{var a=t.get().peer,r=(0,u.getTab)(t,a);(0,s.showVerifiedTooltip)(n,(0,C.isBusinessNotifyTab)(r)?r.ownerId:a)},p=K.bind(null,t,e),v=z.bind(null,t,e),_=Y.bind(null,t,e,n),b=()=>r().showSettings(t),I=n=>{var a=t.get().peer;(0,s.isContactPeer)(a)&&((0,f.mount)(t,a,e),cancelEvent(n)),!gpeByClass("im-page--chat-header_chat",n.target,e)||gpeByClass("im-page--chat-header_vkcomgroup",n.target,e)||checkEvent(n)||(b(),cancelEvent(n))},E=()=>function(e,t){var n=()=>{t&&(t.classList.remove(M),t.removeEventListener("mouseleave",n))};t&&(t.classList.add(M),t.addEventListener("mouseleave",n)),e.get().longpoll.abortWaiting()}(t,e),S=(0,o.createModule)({handlers:(n,a)=>{a(e,"click",k,d),a(e,"click","_im_action",h),a(e,"click",s.DESELECT_ALL_CLASS,m),a(e,"mouseover",A,g),a(e,"mouseover",w,p),a(e,"mouseover",k,v),a(e,"click",w,_),a(e,"click","_im_header_link",I),a(e,"click","_im_page_peer_name",I),a(e,"click","_im_chat_members",b),a(e,"click","_im_page_reconnect",E),a(e,"click","_im_page_back",(e=>{checkEvent(e)||(t.get().longpoll.push([(0,c.resetPeer)()]),cancelEvent(e))}))}});return(0,s.isReservedPeer)(t.get().peer)||setTimeout((()=>{t.set(i.setActions).then(r().changeActions)})),l(e,n,S,r)}},595869:(e,t,n)=>{"use strict";n.d(t,{mount:()=>d});n(940851),n(296253);var a=n(667294),r=n(533246),o=n(973935),i=n(879274),s=n(888563);function l(e,t,n){var r=c();if(r){var l=t-19e8;o.render(a.createElement(i.ContactPopup,{store:e,onClose:n.closeContactPopup,getContactInfo:()=>function(e,t){return(0,s.checkContactListLoaded)(e).then((e=>{var n=function(e,t){var n=e.get().contactsList;return n?n.find((e=>e.id===t)):null}(e,t);return Promise.resolve(n)}))}(e,l)}),r)}}function c(){return document.querySelector("._im_contact_popup_container")}function u(e,t){return{unmount:()=>function(e,t){var n=c();n&&o.unmountComponentAtNode(n),(0,r.destroyModule)(e)}(e),closeContactPopup(){var e=c();o.unmountComponentAtNode(e)}}}function d(e,t,n,a){var o=(0,(0,r.createMutations)(u).bindMutations)((0,r.createModule)({handlers:(e,t)=>{}}),e);return l(e,t,o),o}},632910:(e,t,n)=>{"use strict";n.d(t,{mount:()=>g});n(940851),n(296253);var a,r=n(533246),o=n(667294),i=n(973935),s=n(800234),l=n(649159),c=n(389430);function u(){a&&a.hide()}function d(){a&&a.updateBoxCoords()}function h(){return document.querySelector("#MessageForward")}function m(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),a=isVisible(t);return{unmount(){var t=h();t&&i.unmountComponentAtNode(t),(0,r.destroyModule)(e)},showLoader(){boxRefreshCoords(n),show(n),a||show(t)},hideLoader(){hide(n),a||hide(t)}}}function g(e,t,n){var g=(0,(0,r.createMutations)(m).bindMutations)((0,r.createModule)({handlers:(e,t)=>{}})),p={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){var t=h();t&&i.render(o.createElement(s.default,{value:e},o.createElement(l.MessageForward,{closePopup:u,updatePopup:d})),t)}(t),requestAnimationFrame((()=>a.updateBoxCoords()))},onHideAttempt:()=>(t.set(c.prepareForward.bind(null,null)),g.unmount(),!0)};return g.showLoader(),Promise.resolve().then((e=>{g.hideLoader(),a=new MessageBox(p).content('<div id="MessageForward"></div>').show()})),g}},287707:(e,t,n)=>{"use strict";n.d(t,{ChatCreation:()=>S});var a,r=n(570655),o=n(667294),i=n(41437),s=n(706885),l=n(456047),c=n(838091),u=n(410861),d=n(398834),h=n(774415),m=n(881150),g=n(111189),p=n(122902),v=n(91257),f=n(227192),_=n(537510),C=n(575e3),b=n(888563),I=n(432975),E=n(428128);!function(e){e[e.LOADING=0]="LOADING",e[e.LIST=1]="LIST",e[e.SETTINGS=2]="SETTINGS",e[e.PHOTO=3]="PHOTO",e[e.ERROR=4]="ERROR"}(a||(a={}));var S=function(e){var t=e.store,n=e.uploadAvatar,S=e.onClose,y=e.onBack,T=e.onCreateChat,w=e.onGoToConvo,k=e.preselectedUsers,A=(0,r.__read)((0,o.useState)([]),2),L=A[0],M=A[1],P=(0,r.__read)((0,o.useState)(a.LOADING),2),N=P[0],R=P[1],B=(0,r.__read)((0,o.useState)(0),2),F=B[0],O=B[1],D=(0,r.__read)((0,o.useState)(""),2),x=D[0],U=D[1],H=(0,r.__read)((0,o.useState)(""),2),j=H[0],q=H[1],G=(0,r.__read)((0,o.useState)(void 0),2),V=G[0],K=G[1],z=(0,r.__read)((0,o.useState)(k?new Map(k.map((function(e){return[e.id,(0,u.getTokenFromUserItem)(e)]}))):new Map),2),W=z[0],Y=z[1];(0,o.useEffect)((function(){(function(e){return(0,v.unpackStore)(e).hintsTree.then((function(t){var n=t.list.map((function(e){var t=(0,r.__read)(e,3),n=t[0];return{id:+n,peerId:+n,name:t[1],photo:t[2]}}));return function(e,t){return(0,b.checkContactListLoaded)(e).then((function(e){var n=e.get().contactsList.filter((function(e){return!e.user})).sort((function(e,t){return e.id<t.id?1:-1})).map((function(e){return{id:(0,I.getContactPeerId)(e.id),peerId:(0,I.getContactPeerId)(e.id),name:e.name,photo:e.photo||""}})),a=n.splice(0,n.length<3?n.length:3);return(0,r.__spreadArray)((0,r.__spreadArray)((0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(t.slice(0,4))),(0,r.__read)(a)),(0,r.__read)(t.slice(4))),(0,r.__read)(n))}))}(e,n)}))})(t).then((function(e){if(k){var t=k.reduce((function(e,t){return e[t.peerId]=!0,e}),{}),n=k.concat(e.filter((function(e){return!t[e.peerId]})));M(n)}else M(e)})).then((function(){return R(a.LIST)})).catch((function(){R(a.ERROR)}))}),[]);var $=(0,f.debouncedPromise)(_.searchHints,300);switch(N){case a.SETTINGS:return o.createElement(l.ChatCreationModal,{title:(0,i.getLang)("mail_chat_creation_settings"),onClose:S,onBack:function(){return R(a.LIST)}},o.createElement(c.ChatSettingsContainer,{flags:F,setFlags:O,onClose:function(){return R(a.LIST)}}));case a.LIST:return o.createElement(l.ChatCreationModal,{title:(0,i.getLang)("mail_im_create_chat"),onBack:y,onClose:S},o.createElement(u.UsersListContainer,{usersList:L,selectedMap:W,setSelectedMap:Y,onServerSearch:function(e,n){return $(e,n,C.HintsSearchType.FRIENDS_AND_CONTACTS,{},t.get())}}),o.createElement(d.ConvoInfoContainer,{title:x,photo:j,selectedUserIds:Array.from(W.keys()),onTitleChange:U,onShowSettings:function(){return R(a.SETTINGS)},onCreateChat:function(){var e=Array.from(W.keys()),n=V||void 0;return t.set((function(t){return(0,p.createChatAction)(t,n,e,x,F)})).then((function(e){var t=e.get().next_peer;T(t),(0,E.collectChatCreateStats)(t,"create_chat__create_new")}))},onUploadAvatar:function(){R(a.PHOTO),n().then((function(e){if(e.photo&&e.photoData){var t=e.photo,n=e.photoData;q(t),K(n)}else K(void 0);R(a.LIST)})).catch((function(){R(a.ERROR)}))},onRemoveAvatar:function(){q(""),K(void 0)},onGoToConvo:w}));case a.ERROR:return o.createElement(l.ChatCreationModal,{title:(0,i.getLang)("global_error"),onClose:S},o.createElement(g.ModalBody,null,o.createElement("p",null,(0,i.getLang)("global_error"))),o.createElement(h.ModalFooter,{actionButtons:o.createElement(m.default,{onClick:S},(0,i.getLang)("global_close"))}));case a.LOADING:return o.createElement(s.default,null);case a.PHOTO:return o.createElement(o.Fragment,null)}}},421273:(e,t,n)=>{"use strict";n.d(t,{ChatCreationInfo:()=>u});var a=n(667294),r=n(581685),o=n(838482),i=n(595775),s=n(423558),l=n(41437),c=n(125396),u=function(e){var t=e.onChangeTitle,n=e.onResetTitle,u=e.onShowSettings,d=e.onButtonClickHandler,h=e.title,m=e.photo,g=e.loading,p=e.onUploadAvatar,v=e.onRemoveAvatar,f=e.isButtonDisabled,_=e.buttonText;return a.createElement("div",{className:"ChatCreationInfo"},a.createElement("div",{className:"ChatCreationInfo__avatarWrapper"},a.createElement(r.default,{photo:m,title:h,className:"ChatCreationInfo__avatar",onClick:p}),m&&a.createElement(o.default,{text:(0,l.getLang)("mail_settings_remove_photo"),position:"t",align:"left"},a.createElement("button",{onClick:v,className:"ChatCreationInfo__avatarRemove"}))),a.createElement(i.default,{className:"ChatCreationInfo__titleInput",isControlledOutside:!0,value:h,onChange:function(e){return t(e.target.value)},onCancel:n,placeholder:(0,l.getLang)("mail_im_chat_title_intro")}),a.createElement(o.default,{text:(0,l.getLang)("mail_chat_creation_settings_icon_tooltip"),position:"t"},a.createElement("button",{className:"ChatCreationInfo__settings",onClick:u,"aria-label":(0,l.getLang)("mail_chat_creation_settings_icon_tooltip")},a.createElement(c.default,null))),a.createElement(s.default,{disabled:f,loading:g,onClick:d},_))}},456047:(e,t,n)=>{"use strict";n.d(t,{ChatCreationModal:()=>s});var a=n(138671),r=n(838480),o=n(667294),i=n(41437),s=function(e){var t=e.children,n=e.title,s=e.onClose,l=e.onBack;return o.createElement(a.default,{onClose:s,disableBodyScroll:!0,className:"ChatCreationModal"},o.createElement(r.ModalHeader,{title:n,onClose:s,backText:l?(0,i.getLang)("global_back"):void 0,onBack:l}),o.createElement("div",{className:"ChatCreationModal__content"},t))}},743543:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserRow:()=>c});var a=n(248586),r=n(750598),o=n(123683),i=n(667294),s=n(663527),l=n(906942),c=function(e){var t=e.data,n=e.onSelect,c=e.isSelected,u=t.photo?t.photo:i.createElement(l.ConversationNoPhoto,{id:t.peerId,text:(0,s.getUserInitials)(t.name),size:"34",specificType:7});return i.createElement(r.default,{"data-id":t.peerId,onClick:function(){return n(t.peerId)},selectable:!0,aside:i.createElement(o.ListMultiSelectControl,{isSelected:c})},i.createElement(a.default,{"data-id":t.peerId,size:"34",title:t.name,photo:u}))}},486288:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserList:()=>i});var a=n(667294),r=n(167578),o=n(41437),i=function(e){var t=e.usersList,n=e.onRemoveToken,i=e.onChange,s=e.onSelect,l=e.renderSuggest,c=e.tokens,u=e.query;return a.createElement(r.default,{className:"ChatCreationUserList",tokens:c,removeTokenPlaceholder:(0,o.getLang)("mail_create_chat_remove_user"),onRemoveToken:n,placeholder:(0,o.getLang)("mail_search_creation"),value:u,onChange:i,onSelect:s,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:function(){},notFoundText:(0,o.getLang)("mail_no_users_found"),autoFocus:!0,isSearching:!1,renderSuggest:l,data:t})}},838091:(e,t,n)=>{"use strict";n.d(t,{ChatSettingsContainer:()=>o});var a=n(667294),r=n(732779),o=function(e){var t=e.setFlags,n=e.flags,o=e.onClose;return a.createElement(r.ChatSettingsOptions,{flags:n,back:o,isChatCreation:!0,onSave:function(e){return t(e),Promise.resolve()},afterSave:o,onCancel:o})}},398834:(e,t,n)=>{"use strict";n.d(t,{ConvoInfoContainer:()=>s});var a=n(570655),r=n(421273),o=n(667294),i=n(41437),s=function(e){var t=e.title,n=e.photo,s=e.selectedUserIds,c=e.onShowSettings,u=e.onTitleChange,d=e.onCreateChat,h=e.onUploadAvatar,m=e.onRemoveAvatar,g=e.onGoToConvo,p=(0,a.__read)((0,o.useState)(!1),2),v=p[0],f=p[1],_=(0,a.__read)((0,o.useState)(!l(t)),2),C=_[0],b=_[1],I=1===s.length&&!C&&!n,E=0!==s.length||C,S=(0,o.useCallback)((function(e){b(!l(e)),u(e)}),[]),y=!I&&!E,T=I?(0,i.getLang)("mail_im_go_to_dialog"):(0,i.getLang)("mail_im_create_chat");return o.createElement(r.ChatCreationInfo,{title:t,onResetTitle:function(){return S("")},onChangeTitle:S,photo:n,onShowSettings:c,onButtonClickHandler:function(){if(!v)if(f(!0),I){var e=(0,a.__read)(s,1)[0];g(+e)}else d().catch((function(){f(!1)}))},loading:v,isButtonDisabled:y,onUploadAvatar:h,onRemoveAvatar:m,buttonText:T})};function l(e){return!e.trim().replace("\n","")}},410861:(e,t,n)=>{"use strict";n.d(t,{UsersListContainer:()=>c,getTokenFromUserItem:()=>d});var a=n(570655),r=n(667294),o=n(486288),i=n(743543),s=n(729685),l=n(897557),c=function(e){var t=e.usersList,n=e.selectedMap,l=e.setSelectedMap,c=e.onServerSearch,h=(0,a.__read)((0,r.useState)(""),2),m=h[0],g=h[1],p=(0,a.__read)((0,r.useState)(t.map((function(e){return e.peerId}))),2),v=p[0],f=p[1],_=(0,r.useRef)(u(t)),C=(0,r.useCallback)((function(e){return e.name}),[]),b=(0,r.useCallback)((function(e){return e.peerId}),[]),I=(0,s.useIndexer)(Array.from(_.current.values()),C,b),E=(0,r.useMemo)((function(){return Array.from(_.current.keys())}),[_.current]),S=(0,r.useCallback)((function(e,t){return c(e,t)}),[c]);(0,r.useEffect)((function(){var e=I.search(m).map((function(e){return e.peerId}));f(e),S(m,e).then((function(t){if(0!==m.length){var n=[],r=[];t.forEach((function(e){_.current.has(e.peerId)||(r.push(e.peerId),n.push(function(e){return{id:e.peerId,peerId:e.peerId,name:e.name,photo:e.photo}}(e)))})),n.length&&(o=_,i=u(n),o.current=new Map((0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(Array.from(o.current.entries()))),(0,a.__read)(Array.from(i.entries())))),f((0,a.__spreadArray)((0,a.__spreadArray)([],(0,a.__read)(e)),(0,a.__read)(r))))}var o,i})).catch((function(){}))}),[m]);var y=function(e){n.delete(e),l((function(){return new Map(n)}))},T=function(e){n.has(e)?y(e):(!function(e){var t=_.current.get(e);t&&(n.set(e,d(t)),l((function(){return new Map(n)})))}(e),g(""))},w=(0,r.useCallback)((function(e){y(+e)}),[n]),k=(0,r.useCallback)((function(e){g(e.target.value)}),[m]),A=Array.from(n.values());return r.createElement(o.ChatCreationUserList,{query:m,tokens:A,usersList:m?v:E,onSelect:T,onChange:k,onRemoveToken:w,renderSuggest:function(e){var t=_.current.get(e);return t?r.createElement(i.ChatCreationUserRow,{key:e,data:t,onSelect:T,isSelected:n.has(e)}):r.createElement(r.Fragment,null)}})};function u(e){return e.reduce((function(e,t){return t.name=(0,l.decodeHTMLEntities)(t.name),e.set(t.id,t)}),new Map)}function d(e){return{id:e.id.toString(),text:e.name}}},879274:(e,t,n)=>{"use strict";n.d(t,{ContactPopup:()=>d});var a=n(570655),r=n(667294),o=n(138671),i=n(7692),s=n(448975),l=n(706885),c=n(41437),u=n(907851),d=function(e){var t=e.getContactInfo,n=e.onClose,d=(0,a.__read)((0,r.useState)({kind:"loading"}),2),h=d[0],m=d[1];switch((0,r.useEffect)((function(){var e=function(e){(0,u.showErrorBox)(e),m({kind:"failed"}),n()};t().then((function(t){t?m({kind:"loaded",contact:t}):e((0,c.getLang)("mail_contact_was_removed"))})).catch((function(){e((0,c.getLang)("global_error"))}))}),[]),h.kind){case"failed":return r.createElement(r.Fragment,null);case"loading":return r.createElement(l.default,null);case"loaded":return r.createElement(o.default,{onClose:n,className:"ContactPopup"},r.createElement(i.default.Header,{title:(0,c.getLang)("mail_contact"),onClose:n}),r.createElement(s.ContactPopupContent,{contact:h.contact}))}}},620935:(e,t,n)=>{"use strict";n.d(t,{ContactIconRow:()=>o});var a=n(667294),r=n(121265),o=function(e){var t=e.icon,n=e.children,o=(0,r.classNames)("ContactIconRow__icon","ContactIconRow__icon--"+t);return a.createElement("div",{className:"ContactIconRow"},a.createElement("div",{className:o}),a.createElement("div",{className:"ContactIconRow__text"},n))}},448975:(e,t,n)=>{"use strict";n.d(t,{ContactPopupContent:()=>u});var a=n(667294),r=n(663527),o=n(620935),i=n(906942),s=n(30081),l=n(41437),c=n(432975),u=function(e){var t=e.contact,n=(0,c.getContactPeerId)(t.id);return a.createElement("div",{className:"ContactPopupContent"},a.createElement("header",{className:"ContactPopupContent__header"},a.createElement("div",{className:"ContactPopupContent__photo"},t.photo?a.createElement("img",{className:"ContactPopupContent__contactAvatarImage",src:t.photo,alt:t.name}):a.createElement(i.ConversationNoPhoto,{text:(0,r.getUserInitials)(t.name),size:"80",id:n,specificType:7,key:t.id})),a.createElement("h3",{className:"ContactPopupContent__title"},a.createElement(s.default,null,(0,r.prepareContactName)(t.name))),a.createElement("div",{className:"ContactPopupContent__meta"},(0,l.getLang)("mail_from_contacts_list"))),a.createElement("div",{className:"ContactPopupContent__info"},t.main_phone&&a.createElement(o.ContactIconRow,{icon:"phone"},(0,r.formatPhoneNumber)(t.main_phone)),t.emails[0]&&a.createElement(o.ContactIconRow,{icon:"mail"},a.createElement("a",{href:"mailto:"+t.emails[0]},t.emails[0]))),t.sync_date&&a.createElement("div",{className:"ContactPopupContent__info"},a.createElement(o.ContactIconRow,{icon:"sync"},t.sync_date)))}},166056:(e,t,n)=>{"use strict";n.d(t,{convoPickerMode:()=>a,ConvoPicker:()=>b});var a,r=n(570655),o=n(667294),i=n(973935),s=n(121265),l=n(736434),c=n(884143),u=n(148434),d=n(658861),h=n(229852),m=n(41437),g=n(752141),p=n(929566),v=n(663527),f=n(750598),_=n(916972),C=m.default.getLang;!function(e){e.DEFAULT="default",e.RADIO="radio"}(a||(a={}));var b=function(e){var t,n=e.searchValue,m=void 0===n?"":n,b=e.isLoading,I=void 0!==b&&b,E=e.convos,S=e.mode,y=void 0===S?a.DEFAULT:S,T=e.selectedConvos,w=void 0===T?[]:T,k=e.checkDisabled,A=e.onSearchValueChange,L=e.onSearchInputKeydown,M=e.onConvoSelect,P=e.onListLoadMore,N=void 0===P?function(){}:P,R=e.onAddClick,B=e.searchInputGetter,F=e.className,O=e.style,D=(0,r.__rest)(e,["searchValue","isLoading","convos","mode","selectedConvos","checkDisabled","onSearchValueChange","onSearchInputKeydown","onConvoSelect","onListLoadMore","onAddClick","searchInputGetter","className","style"]),x=(0,s.classNames)("ConvoPicker",F),U=(0,o.createRef)(),H=(0,r.__read)((0,o.useState)(0),2),j=H[0],q=H[1],G=function(e){var t=Math.max(e-1,0);return k&&k(E[t])?G(t):t},V=function(e){var t=Math.min(e+1,E.length-1);return k&&k(E[t])?V(t):t},K=function(e){e!==j&&(q(e),function(e){if(t){var n=E[e].peerId,a=t.querySelector('[data-id="'+n+'"]');if(a&&a instanceof HTMLElement){var r=a.offsetTop,o=t.scrollTop;if(r<o)t.scrollTop=r;else{var i=t.offsetHeight,s=r+a.offsetHeight;s>o+i&&(t.scrollTop=s-i)}}}}(e))};(0,o.useEffect)((function(){B&&U.current&&B(U.current.element)}),[]);var z=!!R&&!m,W=(z?[o.createElement(f.default,{selectable:!1,key:"add","data-id":0},o.createElement(_.ListAddControl,{onClick:R},C("mail_new_convo_from_invite")))]:[]).concat(E.map((function(e,t){var n=e.peerId,a=e.photo,r=e.name,i=e.online,s=!!k&&k(e);return o.createElement(g.ConvoPickerRow,{key:n,"data-id":n,peerId:n,photo:a,name:r,online:i,memberCount:(0,v.getChatMemberCount)(e),mode:y,isCasper:(0,p.isCasperChatTab)(e),isSelected:w.includes(n),isActive:t===j,isDisabled:s,onClick:function(){s||M(n)},onMouseEnter:function(){return q(s?-1:t)}})})));return o.createElement("div",(0,r.__assign)({className:x,onMouseLeave:function(){return q(-1)},style:O},D),o.createElement(l.BlockSearchInput,{value:m,onChange:A,onKeyDown:function(e){switch(e.which||e.keyCode){case h.ARROW_UP:K(G(j)),e.preventDefault();break;case h.ARROW_DOWN:K(V(j)),e.preventDefault();break;case h.ENTER:M(E[j].peerId),e.preventDefault()}L(e)},placeholder:C("mail_top_search"),autoFocus:!0,key:"search",ref:U}),I&&o.createElement(c.default,{className:"ConvoPicker__stub",key:"loading"},o.createElement(u.default,null)),!I&&m&&0===E.length&&o.createElement(c.default,{className:"ConvoPicker__stub",key:"no-results"},C("mail_im_search_empty_chats")),!I&&(E.length>0||z)&&o.createElement(d.default,{virtualized:!0,className:"ConvoPicker__results",loadMore:N,hasMore:!1,ref:function(e){var n=i.findDOMNode(e);n&&n instanceof HTMLElement&&(t=n)},key:"results"},W))}},752141:(e,t,n)=>{"use strict";n.d(t,{ConvoPickerRow:()=>g});var a=n(570655),r=n(667294),o=n(121265),i=n(750598),s=n(248586),l=n(663527),c=n(166056),u=n(471709),d=n(906942),h=n(581685),m=n(206566),g=function(e){var t=e.peerId,n=e.name,g=e.photo,p=e.online,v=e.memberCount,f=e.mode,_=void 0===f?c.convoPickerMode.DEFAULT:f,C=e.isSelected,b=e.isDisabled,I=e.isActive,E=e.isCasper,S=e.className,y=(0,a.__rest)(e,["peerId","name","photo","online","memberCount","mode","isSelected","isDisabled","isActive","isCasper","className"]),T=function(e,t,n,a){void 0===a&&(a=0);var o=(0,l.isContactPeer)(e);switch(!0){case Array.isArray(n):return r.createElement(u.default,{photos:n});case o:return r.createElement(d.ConversationNoPhoto,{id:e,text:(0,l.getUserInitials)(t),size:"34",specificType:7});default:return r.createElement(h.default,{isOnline:!!a,isMobile:!!m.mobPlatforms[a],title:t,photo:n,onlineSize:"s"})}}(t,n,g,p),w=E?'<span class="ConvoPickerRow__itemTitle ConvoPickerRow__itemTitle--casper">\n        <span class="ConvoPickerRow__itemTitleText">\n          '+n+"\n        </span>\n      </span>":n,k=_===c.convoPickerMode.RADIO?r.createElement("span",{className:(0,o.classNames)("ConvoPickerRow__radio",{"ConvoPickerRow__radio--selected":C})}):void 0,A=(0,o.classNames)("ConvoPickerRow",S,{"ConvoPickerRow--disabled":b});return r.createElement(i.default,(0,a.__assign)({active:I,selectable:!b,canBeHovered:!1,chevron:_===c.convoPickerMode.DEFAULT&&!b,aside:k,className:A},y),r.createElement(s.default,{ignoreDecodeHTML:!0,size:"34",title:r.createElement("span",{dangerouslySetInnerHTML:{__html:w}}),photo:T,description:v,className:"ConvoPickerRow__itemContent"}))}},504685:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteContainer:()=>L});var a,r=n(570655),o=n(667294),i=n(397512),s=n(774415),l=n(731585),c=n(166056),u=n(122902),d=n(762371),h=n(351117),m=n(791563),g=n(41437),p=n(706885),v=n(537510),f=n(116886),_=n(992665),C=n(841645),b=n(371372),I=n(949597),E=n(344624),S=n(432975),y=n(575e3),T=n(287707),w=n(161945),k=n(428128),A=g.default.getLang;!function(e){e[e.PICKER=0]="PICKER",e[e.CREATION=1]="CREATION"}(a||(a={}));var L=function(e){var t=e.user,n=e.store,g=e.onClose,L=e.onInviteSent,M=e.onGoToConvo,P=(0,r.__read)((0,o.useState)(a.PICKER),2),N=P[0],R=P[1],B=(0,r.__read)((0,o.useState)(!function(e){var t,n=e.get(),a=n.chatList||(null===(t=n.dialog_tabs)||void 0===t?void 0:t.all);return Boolean(a&&a.length>0)}(n)),2),F=B[0],O=B[1],D=(0,r.__read)((0,o.useState)(!0),2),x=D[0],U=D[1],H=(0,r.__read)((0,o.useState)(!1),2),j=H[0],q=H[1],G=(0,r.__read)((0,o.useState)(function(e){var t,n=e.get(),a=n.chatList||((null===(t=n.dialog_tabs)||void 0===t?void 0:t.all)||[]).filter(b.isChatPeer);if(a&&a.length>0)return a.map((function(t){return(0,h.getTab)(e,t)}));return[]}(n)),2),V=G[0],K=G[1],z=(0,r.__read)((0,o.useState)(""),2),W=z[0],Y=z[1],$=(0,o.useCallback)((function(e){Y(e.target.value)}),[W]),Q=(0,o.useCallback)((function(){}),[]),J=(0,o.useRef)(null),X=(0,r.__read)((0,I.useHints)(n,V,W,{queryType:y.HintsSearchType.ALL,filterFn:function(e){return(0,b.isChatPeer)(e.peerId)}}),2),Z=X[0],ee=X[1];(0,o.useEffect)((function(){return(0,v.loadConversations)(n.get(),d.ConvoFilters.CHATS,200).then((function(e){var t=e.items;return K((0,S.mergeConvoLists)(V,t)),t})).then((function(e){var t=e.reduce((function(e,t){return e[t.peerId]=t,e}),{});return n.set((function(n){return(0,C.mergeTabs)(n,t).then((function(t){return(0,_.setChatList)(t,e.map((function(e){return e.peerId})))}))}))})).finally((function(){return O(!1)})),(0,E.cancelStackPush)("convo_invite",(function(){})),function(){setTimeout((function(){return(0,E.cancelStackFilter)("convo_invite")}),0)}}),[]);var te=t.inv_name?(0,f.langStr)((0,f.langSex)(t.sex,A("mail_im_invite_user",!0)),"user",t.inv_name):A("mail_convo_invite_title");return o.createElement(o.Fragment,null,N===a.PICKER&&o.createElement(i.UserConvoInviteModal,{title:te,onCloseModal:g,footer:o.createElement(s.ModalFooter,null,o.createElement(l.default,{checked:x,onChange:function(e,t){return U(t)}},A("mail_im_chat_add_members_show_history")))},o.createElement(c.ConvoPicker,{convos:Z.map((function(e){return(0,h.getTab)(n,e.peerId)||e})),searchValue:W,onSearchValueChange:$,onSearchInputKeydown:Q,onConvoSelect:function(e){q(!0),Promise.resolve().then((function(){return n.set((function(n){return(0,u.addNewMember)(e,[t.id],x,n)}))})).then((function(){return L(e)})).then((function(){g(),q(!1)})).catch((function(e){q(!1),(0,m.showFastBox)(A("global_error"),e)}))},checkDisabled:function(e){return!e.canInvite},searchInputGetter:function(e){return J.current=e},isLoading:F||ee&&0===Z.length,style:{height:410},onAddClick:function(){return R(a.CREATION)}})),N===a.CREATION&&o.createElement(T.ChatCreation,{store:n,uploadAvatar:w.uploadConvoPhoto,onClose:g,onBack:function(){return R(a.PICKER)},onCreateChat:function(e){L(e).then((function(){}),(function(){})),g(),(0,k.collectChatCreateStats)(e,"create_chat__create_invite")},onGoToConvo:function(e){M(e),g()},preselectedUsers:[{id:t.id,peerId:t.id,name:t.name,photo:t.photo}]}),j&&o.createElement(p.default,null))}},397512:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteModal:()=>s});var a=n(667294),r=n(138671),o=n(41437),i=n(838480),s=function(e){var t=e.title,n=e.onCloseModal,s=e.footer,l=e.isWithBackButton,c=void 0!==l&&l,u=e.onBackClick,d=e.children;return a.createElement(r.default,{className:"UserConvoInviteModal",disableBodyScroll:!0,onClose:n},a.createElement(i.ModalHeader,{title:t,onClose:n,backText:c?(0,o.getLang)("global_back"):void 0,onBack:u,className:"UserConvoInviteModal__header"}),a.createElement("div",{className:"UserConvoInviteModal__content"},d),s)}},736929:(e,t,n)=>{"use strict";n.d(t,{mount:()=>c});var a=n(533246),r=n(667294),o=n(973935),i=n(504685);function s(){var e="_im_user_convo_invite",t=document.getElementById(e);if(t)return t;var n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}function l(e){return{unmount:function(){var t=s();t&&o.unmountComponentAtNode(t),(0,a.destroyModule)(e)}}}function c(e,t,n,c){var u=(0,(0,a.createMutations)(l).bindMutations)((0,a.createModule)({handlers:function(){}}));return function(e,t,n,a,l){var c=s();o.render(r.createElement(i.UserConvoInviteContainer,{user:n,store:e,onClose:t.unmount,onInviteSent:a,onGoToConvo:l}),c)}(e,u,t,n,c),u}},261808:(e,t,n)=>{"use strict";n.d(t,{handleUiActionForPeer:()=>k});var a=n(324466),r=n(371372),o=n(663527),i=n(389430),s=n(81020),l=n(116886),c=n(791563),u=n(537510),d=n(907851),h=n(428128),m=n(896282),g=n(621941),p=n(736929),v=n(992828),f=n(236205),_=n(442699),C=n(705456),b=n(69785),I=n(841645),E=n(469433),S=n(621260),y=n(351117),T=n(713075),w=n(172989);function k(e,t,n,k,A,L){var M,P,N,R,B,F,O;switch(void 0===L&&(L=function(e){return(0,T.imWeirdLog)("im_ui_action",{error:e},!1)}),k){case a.ConvoAction.CLEAR:var D=(0,y.getTab)(e,A),x=(0,o.showFlushChat)(D,A,(function(){(0,o.cleanHistory)(e,x,t,i.flushHistory,A)}));break;case a.ConvoAction.MEDIA:(0,E.showWiki)({w:"history"+(0,o.convertPeerToUrl)(A)+"_photo"},null,{});break;case a.ConvoAction.CALL_AUDIO:case a.ConvoAction.CALL_VIDEO:(0,o.isCallToPeerAvailable)(e,A)&&(0,o.startCallFromIm)(e,A,k===a.ConvoAction.CALL_VIDEO,[],o.CALL_ENTRY_POINT_HEADER);break;case a.ConvoAction.CALL_APP:(0,o.isCallToPeerAvailable)(e,A)&&(null===(M=window.Calls)||void 0===M?void 0:M.showStartCallModal)&&(0,o.startCallFromIm)(e,A,!1,[],o.CALL_ENTRY_POINT_HEADER,!0);break;case a.ConvoAction.CALL_BY_NAME:(0,o.isCallToPeerAvailable)(e,A)&&(null===(P=window.Calls)||void 0===P?void 0:P.showCallByNamePopup)&&(0,o.startCallFromIm)(e,A,!1,[],o.CALL_ENTRY_POINT_HEADER,!1,!0);break;case a.ConvoAction.SEARCH:null===(R=(N=t()).showSearch)||void 0===R||R.call(N,e);break;case a.ConvoAction.BLOCK_NOTIFY:case a.ConvoAction.BLOCK_COMMUNITY:e.set(i.toggleCommunityMessages.bind(null,!1,A)).then((function(){var t,n;null===(n=null===(t=e.get())||void 0===t?void 0:t.longpoll)||void 0===n||n.push([(0,s.resetPeer)()]),(0,S.showDoneBox)((0,l.getLang)("mail_community_was_blocked"))})).catch(L);break;case a.ConvoAction.ALLOW_COMMUNITY:e.set(i.toggleCommunityMessages.bind(null,!0,A)).then((function(){var t,a;return null===(a=(t=n()).changeActions)||void 0===a?void 0:a.call(t,e)})).catch(L);break;case a.ConvoAction.BLOCK:(0,o.showBlacklistBox)(A,e).once("success",(function(t){var n,a;t.delta&&((0,S.showDoneBox)(t.msg),null===(a=null===(n=e.get())||void 0===n?void 0:n.longpoll)||void 0===a||a.push([(0,s.resetPeer)()]))}));break;case a.ConvoAction.LEAVE:var U=(0,o.showLeaveDialog)(e,A,(function(n){var a,r,l=e.set(i.leaveChat.bind(null,A)).then((function(){return e.set(i.unpinMessageOptimistic.bind(null,A))}));n&&l.then((function(){return(0,o.cleanHistory)(e,U,t,i.flushHistory,A)})).catch(L),U.hide(),null===(r=null===(a=e.get())||void 0===a?void 0:a.longpoll)||void 0===r||r.push([(0,s.resetPeer)()])}));break;case a.ConvoAction.UNREAD:(0,i.markDialogUnread)(A,e.get()).catch(L);break;case a.ConvoAction.RETURN:e.set(i.returnToChat.bind(null,A)).then((function(e){return e.set(i.getPinnedMessage.bind(null,A))})).then(null===(B=t().updateChatTopic)||void 0===B?void 0:B.bind(null,A)).catch((function(e){(0,c.showFastBox)((0,l.getLang)("global_error"),e),L(e)}));break;case a.ConvoAction.MUTE:case a.ConvoAction.UNMUTE:var H=k===a.ConvoAction.MUTE;e.set((function(e){return(0,i.setMutedPeer)(A,H,e)})).then((function(e){var n,a;return null===(a=(n=t()).updateState)||void 0===a?void 0:a.call(n,A,e)})).then((function(){return e.set((function(e){return(0,i.toggleMutePeer)(A,H,-1,e)}))})).catch(L);break;case a.ConvoAction.PIN_CONVO:(0,u.pinConvoHandler)(e.get(),A).catch((function(e){(0,d.showErrorBox)(e),L(e)}));break;case a.ConvoAction.UNPIN_CONVO:(0,u.unpinConvoHandler)(e.get(),A).catch((function(e){(0,d.showErrorBox)(e),L(e)}));break;case a.ConvoAction.CHAT_INVITE:(0,o.inviteUser)(e,A,t,i.setCreationType);break;case a.ConvoAction.USER_INVITE:if((D=(0,y.getTab)(e,A))&&(0,y.isUserConvo)(D)&&D.canBeAddedToChat){(0,h.collectConvoInviteStats)(h.ConvoInviteEntryPoint.DIALOG_ACTIONS,A);var j=(0,r.isContactPeer)(A)?(0,m.makeUserFromUserConvo)(D):(0,g.oCacheGet)(e,A);j&&(0,p.mount)(e,j,(function(t){var n;return Promise.resolve(null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,s.changePeer)(t,!1,!1,!1,"convo_invite")]))}),(function(t){var n;return null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,s.changePeer)(t,!1,!1,!1,"convo_invite")])}))}break;case a.ConvoAction.CREATE_CHAT:D=(0,y.getTab)(e,A);var q=[[A,null==D?void 0:D.tab]];e.set(i.setCreationType.bind(null,"chat",[])).then((function(){var n,a;return null===(a=(n=t()).showCreation)||void 0===a?void 0:a.call(n,e,q)})).catch(L);break;case a.ConvoAction.PIN_HIDE:(0,v.pinnedMessageHide)(e,(0,f.getPeer)(e),t);break;case a.ConvoAction.PIN_UNHIDE:(0,v.pinnedMessageUnHide)(e,(0,f.getPeer)(e),t);break;case a.ConvoAction.UNPIN:(0,v.pinnedMessageUnpin)(e,(0,f.getPeer)(e),t);break;case a.ConvoAction.SETTINGS:null===(O=(F=n()).showSettings)||void 0===O||O.call(F,e);break;case a.ConvoAction.DISABLE_BUSINESS_NOTIFY:var G=(D=(0,y.getTab)(e,A))&&(0,y.isChatConvo)(D)&&D.ownerId;if(!G)return;var V=new c.MessageBox({title:(0,l.getLang)("mail_business_notify_disable_box_title")}).content((0,_.getTemplate)("sImBusinessNotifyDisableBoxContent",{text:(0,l.getLang)("mail_business_notify_disable_box_text")})).addButton((0,l.getLang)("mail_business_notify_disable_box_button"),(function(n){(0,C.lockButton)(n),e.set((function(e){return(0,I.setConvoBusinessNotifyEnabled)(e,A,!1)})).then((function(){return e.set(I.setActions)})).then((function(){var n,a,r,o;return null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(o=(r=t()).updateState)||void 0===o||o.call(r,A,e),(0,b.denyMessagesFromGroup)({group_id:-G})})).then((function(){V.hide()})).catch(L)})).show();break;case a.ConvoAction.ENABLE_BUSINESS_NOTIFY:var K=(D=(0,y.getTab)(e,A))&&(0,y.isChatConvo)(D)&&D.ownerId;if(!K)return;e.set((function(e){return(0,I.setConvoBusinessNotifyEnabled)(e,A,!0)})).then((function(){return e.set(I.setActions)})).then((function(){var n,a,r,o;return null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(o=(r=t()).updateState)||void 0===o||o.call(r,A,e),(0,b.allowMessagesFromGroup)({group_id:-K})})).catch(L);break;case a.ConvoAction.ARCHIVE:if(!(D=(0,y.getTab)(e,A)))break;e.set((function(e){return(0,i.updateFolderState)(A,a.FOLDER_MASKS[a.FOLDER_ARCHIVE],w.SET_DIRECTORIES,!0,!1,(0,d.unpackStore)(e))})).then((function(){return e.set(I.setActions)})).then((function(){var n,a,r,o;null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(o=(r=t()).removePeer)||void 0===o||o.call(r,e,A)})).then((function(){return(0,b.archiveConversation)({peer_id:A})})).catch(L);break;case a.ConvoAction.UNARCHIVE:if(!(D=(0,y.getTab)(e,A)))break;e.set((function(e){return(0,i.updateFolderState)(A,a.FOLDER_MASKS[a.FOLDER_ARCHIVE],w.RESET_DIRECTORIES,!0,!1,(0,d.unpackStore)(e))})).then((function(){return e.set(I.setActions)})).then((function(){var n,r,o,i,l,c;null===(r=(n=t()).updateActions)||void 0===r||r.call(n,e),null===(i=(o=t()).removePeer)||void 0===i||i.call(o,e,A);var u=(0,d.unpackStore)(e);u.active_tab!==a.ConvoListFolder.ARCHIVE||(null===(l=u.dialog_tabs[a.ConvoListFolder.ARCHIVE])||void 0===l?void 0:l.length)||null===(c=null==u?void 0:u.longpoll)||void 0===c||c.push([(0,s.changeTab)(a.ConvoListFolder.ALL)])})).then((function(){return(0,b.unarchiveConversation)({peer_id:A})})).catch(L)}}},729685:(e,t,n)=>{"use strict";n.d(t,{useIndexer:()=>i});var a=n(570655),r=n(337057),o=n(667294),i=function(e,t,n){var i=(0,o.useRef)(null);i.current=i.current?i.current:new r.VkIndexer(e,t);var s=i.current,l=(0,o.useCallback)((function(e){return e.reduce((function(e,t){return e[n(t)]=!0,e}),{})}),[]),c=(0,a.__read)((0,o.useState)(e),2),u=c[0],d=c[1],h=(0,a.__read)((0,o.useState)(l(e)),2),m=h[0],g=h[1];return(0,o.useEffect)((function(){var t=l(e),a=e.filter((function(e){return!m[n(e)]})),r=u.filter((function(e){return!t[n(e)]}));(a.length||r.length)&&(a.forEach((function(e){s.add(e)})),r.forEach((function(e){s.remove(e)})),d(e),g(t))}),[e]),s}},949597:(e,t,n)=>{"use strict";n.d(t,{useHints:()=>h});var a=n(570655),r=n(667294),o=n(227192),i=n(537510),s=n(729685),l=n(432975),c=n(575e3),u=(0,o.debouncedPromise)(i.searchHints,300),d=function(){return!0};function h(e,t,n,o){var i=(0,a.__read)((0,r.useState)(t),2),h=i[0],m=i[1],g=(0,a.__read)((0,r.useState)(!1),2),p=g[0],v=g[1],f=(0,r.useRef)(n),_=(0,r.useCallback)((function(e){return e.name}),[]),C=(0,r.useCallback)((function(e){return e.peerId}),[]),b=(0,s.useIndexer)(t,_,C),I=(0,r.useCallback)((function(e){return o.filterFn?e.filter(o.filterFn):e}),[o.filterFn]);return(0,r.useEffect)((function(){if(f.current=n,n){var a=b.search(n),r=a.map((function(e){return e.peerId}));m(I(a)),v(!0),u(n,r,o.queryType||c.HintsSearchType.ALL,o,e.get()).then((function(e){f.current===n&&(m((0,l.mergeConvoLists)(a,e,o.filterFn||d)),v(!1))})).catch((function(){}))}else m(I(t)),v(!1)}),[n,t]),[h,p]}},161945:(e,t,n)=>{"use strict";n.d(t,{uploadConvoPhoto:()=>i});var a=n(917999),r=n(621260),o=n(575e3);function i(){var e=2e9+Math.round((0,a.rand)(1e6,2e6));return new Promise((function(t){window.cur.recieveCropResult=function(n){window.cur.recieveCropResult=!1,(0,o.ownerPhoto)(JSON.parse(n).data[0],e).then((function(e){var a=Array.isArray(e)?e[0]:e;t({photo:a,photoData:n}),(0,r.curBox)()&&(0,r.curBox)().hide(!0)}),(function(){}))},window.Page.ownerPhoto(e),(0,r.curBox)().setOptions({onHideAttempt:function(e){return e||t({}),!0}})}))}},762371:(e,t,n)=>{"use strict";var a;n.d(t,{ConvoFilters:()=>a}),function(e){e.ALL="all",e.ARCHIVE="archive",e.UNREAD="unread",e.IMPORTANT="important",e.UNANSWERED="unanswered",e.MESSAGE_REQUEST="message_request",e.BUSINESS_NOTIFY="business_notify",e.CHATS="chats"}(a||(a={}))}}]);try{stManager.done("dist/519619abdcf4517008a7b23855d1f7bd.f2286acc7ac4042f890c.js")}catch(e){}