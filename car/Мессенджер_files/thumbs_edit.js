(()=>{"use strict";var t,e,i,a={680140:(t,e,i)=>{i.d(e,{processThumbs:()=>m,compute:()=>f,getSize:()=>_,move:()=>w,scale:()=>b,crop:()=>y,getRatio:()=>T,convert:()=>M,isValidThumbType:()=>x,THUMB_TYPE_ALBUM:()=>h,THUMB_TYPE_DOC:()=>o,THUMB_TYPE_MARKET_ALBUM:()=>d,THUMB_TYPE_PHOTO:()=>s,THUMB_TYPE_VIDEO:()=>l,THUMB_DRAG_ANIMATION_DURATION:()=>u,THUMBS_CONTAINER_DEFAULT_RATIO:()=>c,THUMBS_MESH_GAP:()=>v});i(175115),i(530522),i(991181),i(579665),i(95767),i(66108),i(296253),i(751876);function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t}).apply(this,arguments)}function r(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],a=!0,r=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(t){r=!0,n=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw n}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}!window.isMVK&&(window.vkExpand=window.vkExpand||"VK"+ +new Date,window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var o="doc",s="photo",l="video",h="album",d="market_album",c=1.5,u=window.isMVK?200:120,v=5,p=window.isMVK?604:537,g=window.isMVK?360:343;function m(t,e,i,a){var r=function(t){var e=0;return each(t,((t,i)=>{e+=i})),e},n=function(t,e,i){return(e-(t.length-1)*i)/r(t)},o=(a=E(a)?a:{}).wide,s=[],h=0,d=[],c=[];each(i,((t,e)=>{x(e.type)&&(d[d.length]=e[e.type]),e.type===l&&s.push(h),h++}));var u="",m=[],_=d.length;each(d,((i,a)=>{var r=T(a,t,e);u+=r>1.2?"w":r<.8?"v":"q",m[m.length]=r}));var w,b,y=m.length>0?r(m)/m.length:1,M=v;window.isMVK&&(M=window.innerWidth>=480?6:3);var O=M;a.force?(w=t,b=e):(o?(w=p,b=g):t>=381?(w=381,b=1==_?361:237):(w=337,b=1==_?320:214),t<w&&(w=t,b=e),window.isMVK&&(w=Math.min(p,window.innerWidth),b=Math.min(g,w)));var A=w/b,I=0,B=0;if(1==_){var U={lastColumn:1,lastRow:1,single:1};d[0].thumb?(I=279,B=185):m[0]>=1*A?(I=w,B=Math.min(I/m[0],b)):(B=b,I=Math.min(B*m[0],w));var z=f(d[0],I,B,U);!z.unsized&&(z.image.width<I&&z.image.height<=b||z.image.height<B&&z.image.width<=w)&&(I=z.image.width,B=z.image.height,z=f(d[0],I,B,U)),c[0]=z}else if(2==_){var R,P;switch(u){case"ww":if(y>1.4*A&&m[1]-m[0]<.2){P=w,R=Math.min(P/m[0],P/m[1],(b-O)/2),c[0]=f(d[0],P,R,{lastColumn:1}),c[1]=f(d[1],P,R,{lastColumn:1,lastRow:1}),I=w,B=2*R+O;break}case"vv":case"qv":case"vq":case"qq":P=(w-M)/2,R=Math.min(P/m[0],P/m[1],b),c[0]=f(d[0],P,R,{lastRow:1}),c[1]=f(d[1],P,R,{lastRow:1,lastColumn:1}),I=w,B=R;break;default:var S=intval((w-M)/m[1]/(1/m[0]+1/m[1])),k=w-S-M;R=Math.min(b,S/m[0],k/m[1]),c[0]=f(d[0],S,R,{lastRow:1}),c[1]=f(d[1],k,R,{lastColumn:1,lastRow:1}),I=w,B=R}}else if(3==_)if((m[0]>1.2*A||y>1.5*A)&&"www"==u){var H,N=w,$=Math.min(N/m[0],.66*(b-O));if(c[0]=f(d[0],N,$,{lastColumn:1}),"www"==u){var D=intval(w-M)/2;H=Math.min(b-$-O,D/m[1],D/m[2]),c[1]=f(d[1],D,H,{lastRow:1}),c[2]=f(d[2],w-D-M,H,{lastColumn:1,lastRow:1})}else{var Y=intval((w-M)/m[2]/(1/m[1]+1/m[2])),j=w-Y-M;H=Math.min(b-$-O,Y/m[2],j/m[1]),c[1]=f(d[1],Y,H,{lastRow:1}),c[2]=f(d[2],Y,H,{lastRow:1,lastColumn:1})}I=w,B=$+H+O}else{var L=b,G=intval(Math.min(L*m[0],.75*(w-M)));c[0]=f(d[0],G,L,{lastRow:1});var V=m[1]*(b-O)/(m[2]+m[1]),X=b-V-O,F=Math.min(w-G-M,intval(V*m[2]),intval(X*m[1]));c[1]=f(d[1],F,X,{lastColumn:1}),c[2]=f(d[2],F,V,{lastColumn:1,lastRow:1}),I=G+F+M,B=b}else if(4==_)if((m[0]>1.2*A||y>1.5*A)&&"wwww"==u){var K=w,q=Math.min(K/m[0],.66*(b-O));c[0]=f(d[0],K,q,{lastColumn:1});var W=(w-2*M)/(m[1]+m[2]+m[3]),J=intval(W*m[1]),Q=intval(W*m[2]),Z=K-J-Q-2*M;W=Math.min(b-q-O,W),c[1]=f(d[1],J,W,{lastRow:1}),c[2]=f(d[2],Q,W,{lastRow:1}),c[3]=f(d[3],Z,W,{lastColumn:1,lastRow:1}),I=w,B=q+W+O}else{var tt=b,et=Math.min(tt*m[0],.66*(w-M)),it=(b-2*O)/(1/m[1]+1/m[2]+1/m[3]),at=intval(it/m[1]),rt=intval(it/m[2]),nt=tt-at-rt-2*O;et+(it=Math.min(w-et-M,it))+M<w&&tt*m[0]>et&&(et=Math.min(tt*m[0],w-M-it)),c[0]=f(d[0],et,tt,{lastRow:1}),c[1]=f(d[1],it,at,{lastColumn:1}),c[2]=f(d[2],it,rt,{lastColumn:1}),c[3]=f(d[3],it,nt,{lastColumn:1,lastRow:1}),I=et+it+M,B=b}else{var ot=[],st=0;y>(s.length?1.3:1.1)?each(m,((t,e)=>{ot[ot.length]=Math.max(1,e)})):each(m,((t,e)=>{~s.indexOf(st)?ot[ot.length]=e:ot[ot.length]=Math.min(1,e),st++}));var lt,ht,dt={};for(dt[_+""]=[n(ot,w,M)],lt=1;lt<=_-1;lt++)dt[lt+","+(ht=_-lt)]=[n(ot.slice(0,lt),w,M),n(ot.slice(lt),w,M)];for(lt=1;lt<=_-2;lt++)for(ht=1;ht<=_-lt-1;ht++)dt[lt+","+ht+","+(_-lt-ht)]=[n(ot.slice(0,lt),w,M),n(ot.slice(lt,lt+ht),w,M),n(ot.slice(lt+ht),w,M)];var ct,ut=null,vt=0;for(var pt in dt)if(dt.hasOwnProperty(pt)){var gt=dt[pt],mt=r(gt)+O*(gt.length-1),ft=Math.abs(mt-b);if(~pt.indexOf(",")){for(var _t=pt.split(","),wt=0;wt<_t.length;wt++)_t[wt]=intval(_t[wt]);(_t[0]>_t[1]||_t[2]&&_t[1]>_t[2])&&(ft+=50,ft*=1.5)}(null===ut||ft<vt)&&(ut=pt,vt=ft,ct=mt)}for(var bt=C(d),yt=C(ot),Tt=ut.split(","),Mt=dt[ut],xt=Tt.length-1,Ct=0;Ct<Tt.length;Ct++){var Et=parseInt(Tt[Ct]),Ot=bt.splice(0,Et),At=Mt.shift(),It=Ot.length-1,Bt={};xt==Ct&&(Bt.lastRow=!0);for(var Ut=w,zt=0;zt<Ot.length;zt++){var Rt=Ot[zt],Pt=yt.shift(),St=Bt,kt=void 0;It==zt?(kt=Math.ceil(Ut),St.lastColumn=!0):Ut-=(kt=intval(Pt*At))+M,c[c.length]=f(Rt,kt,At,St)}}I=w,B=ct}return{width:intval(I),height:intval(B),thumbs:c}}function f(t,e,i,a){var r={id:t.id,width:intval(e),height:intval(i),lastColumn:a.lastColumn,lastRow:a.lastRow,single:a.single,image:_(t,e,i,a.single),unsized:t.unsized,type:t.type,orig:t};return t.title&&void 0!==t.size?extend(r,{title:t.title,size:t.size}):t.title&&void 0!==t.msize?extend(r,{title:t.title,msize:t.msize}):t.type===l&&t.name&&void 0!==t.name&&extend(r,{name:t.namem}),"number"==typeof t.duration&&(t.duration=formatTime(t.duration)),r.unsized?r.ratio=1:r.ratio=r.image.width/r.image.height,r}function _(t,e,i,a){if(!t)return{};e=intval(e),i=intval(i);var r,n=window.devicePixelRatio||1;if(t.type===l||t.type===o){(t.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach((a=>{t.sizes[a]&&(!r||e*n<=t.sizes[a][1]&&i*n<=t.sizes[a][2])&&(r=t.sizes[a])}))}else{var s=t.thumb?t.thumb.sizes:t.sizes,h=s.x||s[s.length-1],d=h?(h[1]||1)/(h[2]||1):1,c=0;d>e/i?(c=i,d>1&&(c*=d)):(c=e,d<1&&(c/=d)),i*=n,e*=n;var u=!a&&s.o,v="";v=s.temp?"temp":c<75?"s":c<130?"m":u&&s.o&&s.o[1]>=e&&s.o[2]>=i?"o":u&&s.p&&s.p[1]>=e&&s.p[2]>=i?"p":u&&s.q&&s.q[1]>=e&&s.q[2]>=i?"q":u&&s.r&&s.r[1]>=e&&s.r[2]>=i?"r":"x",r=s[v]||[]}return r[1]=intval(r[1]),r[2]=intval(r[2]),r[1]&&r[2]||(t.unsized=!0),{src:r[0],width:r[1],height:r[2]}}function w(t,e,i){if(i>=t.length)for(var a=i-t.length;1+a--;)t.push(void 0);return t.splice(i,0,t.splice(e,1)[0]),t}function b(t,e,i,a){i=intval(i),a=intval(a)||i;var r=t,n=e;return t>=e&&t>i?(r=intval(i),n=intval(e/(t/i))):t<e&&e>a&&(n=intval(a),r=intval(t/(e/a))),[r,n]}function y(t,e,i){var a=e,r=i,n=0,o=0;if(!t.vid&&t.image.width&&t.image.height){var s=t.image.width/t.image.height;s<e/i?(t.single&&t.image.width<e&&(e=t.image.width,i=Math.min(i,t.image.height)),(r=(a=e)/s)>i&&(o=-intval((r-i)/2))):(t.single&&t.image.height<i&&(i=t.image.height,e=Math.min(e,t.image.width)),(a=(r=i)*s)>e&&(n=-intval((a-e)/2)))}return{width:a,height:r,marginLeft:n,marginTop:t.orig&&(t.type===d||t.type===h)&&t.single?0:o}}function T(t,e,i){var a;switch(t.type){case o:a=t.ratio;break;case l:a=t.ratio||1.777;break;case h:case d:a=1.5;break;default:if(t.sizes&&t.sizes.x){var n=r(t.sizes.x,3),s=n[1],c=n[2];s&&c&&(a=s/c)}if(t.sizes&&t.sizes.temp){var u=r(t.sizes.temp,3),v=u[1],p=u[2];v&&p&&(a=v/p)}}return a||1}function M(t,e,i,n){var c=r(e.split("_"),2),u=c[0],v=c[1],p=a({owner_id:u,ownerId:u,itemId:v,type:t,remove:i.remove,click:i.click,temp:"temp"in i.sizes},n);switch(t){case o:p.data={sizes:i.sizes,ratio:i.ratio,label:i.label,href:i.href},p.doc=p.data;break;case s:p.data={pid:v,sizes:i.sizes,restrictionBlur:i.restrictionBlur,restrictionGeo:i.restrictionGeo,photoId:i.photoId},p.photo=p.data;break;case l:p.data={vid:v,duration:i.duration,platform:i.platform,play_icon:i.play_icon,preview:i.preview,active_live:i.active_live,restriction:i.restriction,ratio:i.ratio,sizes:i.sizes,name:i.name},p.video=p.data;break;case h:p.data={aid:v,title:i.title,size:i.size,thumb:{sizes:i.sizes},restrictionBlur:i.restrictionBlur,restrictionGeo:i.restrictionGeo,photoId:i.photoId},p.album=p.data;break;case d:p.data={type:d,aid:v,title:i.title,msize:i.msize,thumb:{sizes:i.sizes}},p.market_album=p.data}return p.data.type=t,p.data.id=p.temp?`${t}temp_${u}`:`${t}${p.ownerId}_${p.itemId}`,p}function x(t){return!!~[o,s,l,h,d].indexOf(t.toString())}function C(t,e){var i=E(t)||void 0===t.length?{}:[];for(var a in t)(!/webkit/i.test(_ua)||"layerX"!=a&&"layerY"!=a&&"webkitMovementX"!=a&&"webkitMovementY"!=a)&&(e&&"object"==typeof t[a]&&"prototype"!==a&&null!==t[a]?i[a]=C(t[a]):i[a]=t[a]);return i}var E=t=>"[object Object]"===Object.prototype.toString.call(t)},645621:(t,e,i)=>{i.d(e,{ThumbsEdit:()=>h});i(991181),i(579665),i(95767),i(530522),i(21466),i(66108),i(296253);var a=i(469433),r=i(917999),n=i(680140),o=i(719016);function s(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],a=!0,r=!1,n=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(t){r=!0,n=t}finally{try{a||null==s.return||s.return()}finally{if(r)throw n}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}var h={cache:function(){return cur._thEdCache||(cur._thEdCache={}),cur._thEdCache},loaded:function(){return cur._thEdLoaded||(cur._thEdLoaded={}),cur._thEdLoaded},cur:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(){return cur._thEdCur||(cur._thEdCur={}),cur._thEdCur})),getMedias:function(t){var e=[];return(t=ge(t))?((this.cache()[t.id]?this.cache()[t.id].previews:[]).forEach((t=>{this.isValidThumbType(t.type)&&e.push([t.type,`${t.ownerId}_${t.itemId}`])})),e):e},init:function(t,e,i){if(t=ge(t)){(i="boolean"==typeof i?{wide:i}:clone(i)||{}).width&&i.height?i.force=!0:(i.width=t.parentNode.offsetWidth,i.height=Math.round(i.width/n.THUMBS_CONTAINER_DEFAULT_RATIO));var a=[];e.forEach((t=>{this.isValidThumbType(t.type)&&a.push(t)})),domData(t,"te-inited",1),this.cache()[t.id]={previews:a,opts:i,wide:i.wide,height:0,thumbs:[]};var o=this.cur().timer;o&&clearTimeout(o),a.length?this.cur().timer=setTimeout((()=>{var e=this.processThumbs(i.width,i.height,a,i);this.cache()[t.id].thumbs=e.thumbs,this.cache()[t.id].height=e.height;var n=cf();e.thumbs.forEach(((e,i)=>{n.appendChild(this.createThumbEl(t.id,e,i))})),val(t,""),toggleClass(t,"wide",i.wide),setStyle(t,{width:e.width,height:e.height}),t.appendChild(n),show(t),(0,r.isFunction)(i.onUpdate)&&i.onUpdate()}),0):(hide(t),val(t,""))}},getParentTooltipCls:function(t){return gpeByClass("_im_text_input",t)?"_im_text_input":"thumb_wrap"},loadAndDisplayImage:function(t,e){if(t&&e&&e.oldImage){var i=new Image,a=e.image,r=e.oldImage;if(this.loaded()[a.src]&&t.src!==a.src)return t.src=a.src,void delete e.oldImage;var n=()=>{t.src===r.src&&(t.src=a.src,delete e.oldImage,this.loaded()[a.src]=!0),removeEvent(i,"load",n)};addEvent(i,"load",n),i.src=a.src}},createThumbEl:function(t,e,i){if(e&&this.isValidThumbType(e.type)){var s,l=e.oldImage||e.image,h=this.crop(e,e.width,e.height),d="draggable_thumb _draggable clear_fix"+(e.unsized?" unsized"+(e.single?" unsized_single":""):""),c=`thumb_wrap fl_l thumb_${e.type}_wrap`;switch(e.lastColumn&&(c+=" last_column"),e.lastRow&&(c+=" last_row"),e.height<50&&(c+=" thumb_no_controls"),e.type){case n.THUMB_TYPE_ALBUM:case n.THUMB_TYPE_MARKET_ALBUM:e.orig.restrictionGeo||e.image.src.match(/^\/images\//)&&(c+=" page_album_nocover"),(e.title||e.thumb)&&(s=`\n            <div class="page_album_title">\n              <div class="page_album_size">${e.msize||e.size}</div>\n              <div class="page_album_title_text">${e.title}</div>\n            </div>\n          `),e.orig.restrictionBlur&&(d+=" PostPhotoRestriction--blur"),e.orig.restrictionGeo&&(d+=" PostPhotoRestriction--geo");break;case n.THUMB_TYPE_PHOTO:e.orig.restrictionBlur&&(d+=" PostPhotoRestriction--blur"),e.orig.restrictionGeo&&(d+=" PostPhotoRestriction--geo");var u=(0,a.isPhotoeditor3Available)()&&!vk.widget&&!e.orig.restrictionGeo,v=this.cache()[t];s=!(v&&v.opts&&v.opts.nocl)?`\n          <div class="photo_thumb_btns_container">\n            <div class="photo_thumb_btns_overlay">\n              <div class="photo_thumb_btns">\n                <div class="photo_thumb_btn_show _photo_thumb_btn_show" id="ui_btn_show"></div>\n                ${u?'<div class="photo_thumb_btn_editor _photo_thumb_btn_editor" id="ui_btn_pe"></div>':""}\n              </div>\n            </div>\n          </div>\n        `:"";break;case n.THUMB_TYPE_DOC:s=`\n          ${e.orig.label}\n          <a href="${e.orig.href}" class="post_doc_thumb_link" target="_blank" rel="noopener"></a>\n        `;break;case n.THUMB_TYPE_VIDEO:s=e.orig.preview}var p="";e.orig.photoId&&(p=`data-photo-id="${clean(e.orig.photoId)}"`);var g=e.unsized||e.orig.preview?"":`\n      <img class="preview _preview" src="${clean(l.src)}" width="${Math.round(h.width)}" height="${Math.round(h.height)}" style="margin:${h.marginTop}px 0 0 ${h.marginLeft}px;"/>\n    `,m=`\n      <div index="${i}" attachment="${e.id}" ${p} class="${c}"${e.name?` aria-label="${clean(e.name)}"`:""} style="width: ${intval(e.width)}px;height: ${intval(e.height)}px;">\n        <div class="${d}" ${e.unsized?` style="background-image:url(${clean(l.src)})"`:""}>\n          ${g}\n          ${s}\n          ${e.type!==n.THUMB_TYPE_VIDEO?'<div class="overlay _overlay"></div>':""}\n          <div class="ui_thumb_x_button _close_btn" role="link" aria-label="${clean(getLang("dont_attach"))}">\n            <div class="ui_thumb_x"></div>\n          </div>\n        </div>\n      </div>\n    `,f=se(m),_=geByClass1("_preview",f),w=geByClass1("_draggable",f),b=geByClass1("_close_btn",f);if(e.oldImage&&_&&this.loadAndDisplayImage(_,e),addEvent(w,"click",(t=>{if(this.cur().updating||domClosest("_close_btn",t.target))cancelEvent(t);else{var e=gpeByClass("thumb_wrap",t.target),i=this.cache()[e.parentNode.id].previews[e.getAttribute("index")].click;cur.openEditor=hasClass(t.target,"_photo_thumb_btn_editor"),(0,r.isFunction)(i)&&i(t)}})),addEvent(w,"mousedown touchstart",(t=>this.startDrag(t))),addEvent(b,"click",(t=>{var e=gpeByClass("thumb_wrap",t.target);hide(geByClass1("_draggable",e)),this.removeMedia(e.parentNode.id,e.getAttribute("index"))})),addEvent(b,"mouseover",(()=>(0,o.showTooltip)(b,{text:getLang("dont_attach"),shift:[11,8],black:1}))),e.type===n.THUMB_TYPE_PHOTO){var y=geByClass1("_photo_thumb_btn_show",f);y&&addEvent(y,"mouseover",(()=>(0,o.showTooltip)(y,{text:getLang("global_photo_attach_show"),shift:[10,8],black:1,appendParentCls:this.getParentTooltipCls(w)})));var T=geByClass1("_photo_thumb_btn_editor",f);T&&addEvent(T,"mouseover",(()=>(0,o.showTooltip)(T,{text:getLang("global_pe_edit"),shift:[9,8],black:1,appendParentCls:this.getParentTooltipCls(w)})))}return f}},getCoords:function(t,e){var i=[];return e=e||getXY(t),Array.from(t.childNodes).forEach((t=>{if(hasClass(t,"thumb_wrap")){var a=getXY(t);i[i.length]={id:t.getAttribute("attachment"),x:intval(a[0]-e[0]),y:intval(a[1]-e[1]),width:intval(t.offsetWidth),height:intval(t.offsetHeight),index:intval(t.getAttribute("index")),node:t}}})),i},startDrag:function(t){var e=t.touches&&1==t.touches.length,i=null==t.button||0!=t.button&&!(1==t.button&&browser.msie8);if(hasClass(t.target,"_photo_thumb_btn_show")||hasClass(t.target,"_photo_thumb_btn_editor"))return cancelEvent(t);if(!(i&&!e||domClosest("_close_btn",t.target)||this.cur().updating)){var a=hasClass(t.target,"draggable_thumb")?t.target:gpeByClass("draggable_thumb",t.target),r=gpeByClass("editable_thumbs",a),n=this.cache()[r.id];if(n&&!((n.previews||[]).length<2))return this.cur().el=a,this.cur().dragHandler=t=>this.drag(t),this.cur().dropHandler=t=>this.drop(t),addEvent(window,"mousemove touchmove",this.cur().dragHandler),addEvent(window,"mouseup touchend touchcancel",this.cur().dropHandler),e||cancelEvent(t)}},drag:function(t){var e=this.cur().el;if(t.touches&&t.touches.length>1)return this.drop();var i=browser.android?t.touches[0].pageX+(t.pageX||0):t.pageX,a=browser.android?t.touches[0].pageY+(t.pageY||0):t.pageY,r=this.cur();if(hasClass(e,"moving")){var o=i-(r.pos[0]+r.x),l=a-(r.pos[1]+r.y);setStyle(e,{left:o,top:l});var h=r.wpos,d={x:o=r.pos[0]+intval(e.style.marginLeft)+o-h[0],y:l=r.pos[1]+intval(e.style.marginTop)+l-h[1],offsetX:e.offsetWidth,offsetY:e.offsetHeight,index:r.i,node:e},c=!1,u=r.i,v=-1,p=n.THUMBS_MESH_GAP;each(r.coords,(function(t,e){if(t!=r.i&&t!=v){e.offsetX=e.node.offsetWidth+p,e.offsetY=e.node.offsetHeight+p;var i=r.coords[t-1],a=r.coords[t+1],n=d.x+d.offsetX/2,o=d.y+d.offsetY/2,s=e.x+e.offsetX/2,l=e.y+e.offsetY/2,h=e.x+e.offsetX,g=e.y+e.offsetY,m=(i&&i.x==e.x&&i.y!=e.y&&0!=e.y||a&&a.x==e.x&&a.y!=e.y)&&0!=e.x,f=n>=s&&(a&&(n<=a.x+a.offsetX/2&&(a.offsetY==e.offsetY||n<h)||a.y!=e.y)||!a&&d.x<=h)&&o>e.y&&o<g,_=n<s&&n>=e.x&&(!i||i.y!=e.y&&!(i.x==e.x&&!a))&&o>e.y&&o<g,w=m&&o>=l&&o<g&&n>e.x&&n<h,b=m&&o<l&&o>=e.y&&n>e.x&&n<h;f=f&&!m,_=_&&!m&&!f,(f||_||w||b)&&(c=!0,u=e.index<r.i&&(f||w)?e.index+1:d.index<e.index&&(b||_)?e.index-1:e.index),u!=r.i?setStyle(e.node,{left:f?-2:_?2:0,top:w?-2:b?2:0}):setStyle(e.node,{left:0,top:0}),f&&a&&a.y==e.y&&a.x>e.x&&d.index>e.index&&(setStyle(e.node,{left:0,top:0}),setStyle(a.node,{left:2,top:0}),v=t+1),w&&a&&a.x==e.x&&a.y>e.y&&o<=l&&(setStyle(a.node,{left:0,top:0}),v=t+1),b&&i&&i.x==e.x&&i.y<e.y&&o<=l&&(setStyle(i.node,{left:0,top:-2}),setStyle(e.node,{left:0,top:0}))}})),r.to_i=c?u:r.i}else{var g=e.parentNode.parentNode,m=geByClass1("_overlay",e),f=geByClass1("_preview",e),_=intval(e.parentNode.getAttribute("index")),w=this.cache()[g.id].thumbs[_],b=getXY(g),y=getXY(e.parentNode),T=this.getCoords(g,b);r.id=g.id,r.i=_,r.to_i=_,r.x=i-y[0],r.y=a-y[1],r.t=w,r.w=w.width,r.h=w.height,r.pos=y,r.wpos=b,r.crop=this.crop(w,w.width,w.height),r.coords=T;var M=s(this.scale(w.width,w.height,75),2),x=M[0],C=M[1],E=intval((w.width-x)*(browser.mobile?.5:r.x/w.width)),O=intval((w.height-C)*(browser.mobile?.5:r.y/w.height));addClass(e,"moving"),setStyle(e,"zIndex",100);var A={duration:n.THUMB_DRAG_ANIMATION_DURATION,transition:Fx.Transitions.easeOutCubic},I=this.crop(w,x,C);animate(e,{opacity:.85,width:x,height:C,marginLeft:E,marginTop:O},A),animate(m,{opacity:1},A),f&&animate(f,I,A)}return cancelEvent(t)},drop:function(t){var e=this.cur();document.removeEventListener("touchmove",this.preventScroll),e.updating=!0;var i=e.el,a=geByClass1("_overlay",i),o=geByClass1("_preview",i);if(removeEvent(window,"mousemove touchmove",e.dragHandler),removeEvent(window,"mouseup touchend touchcancel",e.dropHandler),!hasClass(i,"moving"))return e.updating=!1,cancelEvent(t);if(e.to_i==e.i){var s=e.crop,l={duration:n.THUMB_DRAG_ANIMATION_DURATION,transition:Fx.Transitions.easeOutCubic};animate(i,{marginTop:0,marginLeft:0,top:0,left:0,width:e.w,height:e.h,opacity:1},extend(l,{onComplete:()=>{setStyle(i,"zIndex",null),e.updating=!1}})),animate(a,{opacity:0},l),o&&animate(o,s,l)}else{var h=this.cache()[e.id].previews;h=this.move(h,e.i,e.to_i),this.update(e.id,h),(0,r.isFunction)((this.cache()[e.id].opts||{}).onMove)&&this.cache()[e.id].opts.onMove()}return removeClass(i,"moving"),cancelEvent(t)},update:function(t,e){if(t=ge(t)){var i=t.id,a=ge(i),o=this.cache()[a.id],s=o.thumbs,l=o.height,h=o.opts,d=!0===h||!1===h?{wide:h}:clone(h||{}),c=d.width,u=d.height;c&&u?d.force=!0:(c=t.parentNode.offsetWidth,u=Math.round(c/n.THUMBS_CONTAINER_DEFAULT_RATIO));var v=this.processThumbs(c,u,e,d),p=se(`\n      <div style="height: 0;overflow: hidden;">\n        <div class="_editable_thumbs editable_thumbs${o.wide?" wide":""}" style="width: ${v.width}px;height: ${v.height}px;"></div>\n      </div>\n    `),g=geByClass1("_editable_thumbs",p);v.thumbs.forEach(((t,e)=>{g.appendChild(this.createThumbEl(i,t,e))})),a.parentNode.appendChild(p);var m=this.getCoords(g);each(m,((t,e)=>{for(var i=null,a=this.cur().coords,r=0,o=a.length;r<o;++r)if(a[r].id==e.id){i=a[r];break}if(null!=i){var l=geByClass1("_draggable",i.node),h=geByClass1("_overlay",l),d=geByClass1("_preview",l),c=s[i.index],u=null;each(v.thumbs,((t,e)=>{e.id==c.id&&(this.loaded()[e.image.src]||(e.oldImage=c.image),u=e)})),setStyle(i.node,{left:0,top:0}),i.height==e.height&&i.width==i.width&&e.x==i.x&&e.y==i.y&&i.index!=this.cur().i||(hasClass(l,"moving")&&fadeOut(h,n.THUMB_DRAG_ANIMATION_DURATION),setTimeout((()=>{animate(l,{top:e.y-i.y,left:e.x-i.x,marginLeft:0,marginTop:0,height:e.height,width:e.width,opacity:1},n.THUMB_DRAG_ANIMATION_DURATION);var t=this.crop(u,e.width,e.height);d&&animate(d,t,n.THUMB_DRAG_ANIMATION_DURATION),toggleClass(l,"unsized_single",u.unsized&&u.single)}),4))}})),l!=v.height&&setTimeout((()=>{animate(a,{height:v.height},n.THUMB_DRAG_ANIMATION_DURATION)}),4),setTimeout((()=>{(0,r.isFunction)(d.onUpdate)&&d.onUpdate(),setStyle(a,{height:v.height,width:v.width}),a.innerHTML="",this.cache()[i].thumbs=v.thumbs,this.cache()[i].previews=e,this.cache()[i].height=v.height,v.thumbs.forEach(((t,e)=>{a.appendChild(this.createThumbEl(i,t,e))})),re(p),this.cur().updating=!1}),n.THUMB_DRAG_ANIMATION_DURATION)}},setWide:function(t,e,i){if(t=ge(t)){var a=this.cache()[t.id],r=clone(i||{});void 0===e&&(e=!1),r.wide=e,a.wide!=e&&this.init(t,a.previews,r)}},hasMedia:function(t,e){if(t=ge(t)){var i=t.id,a=this.cache()[i];if(a){for(var r=0;r<a.previews.length;r++)if(a.previews[r][a.previews[r].type].id==e)return!0;return!1}}},addMedia:function(t,e){if((t=ge(t))&&e){var i=t.id,a=this.cache()[i];if(a){var r=clone(a.previews);10==r.length||this.hasMedia(t,e[e.type].id)||(r[r.length]=e,this.cache()[i]=null,this.init(i,r,clone(a.opts)))}}},updateMedia:function(t,e,i,a){if((t=ge(t))&&e&&i&&a){var r=t.id,n=this.cache()[r];if(n){for(var o=clone(n.previews),s=!1,l=e+i,h=0;h<o.length;h++)if(o[h][o[h].type].id==l){var d=this.convert(e,i,a.editable);o[h]=d,s=!0;break}s&&(this.cache()[r]=null,this.init(r,o,clone(n.opts)))}}},refresh:function(t){if(t=ge(t)){var e=t.id,i=this.cache()[e];i&&(this.cache()[e]=null,this.init(e,clone(i.previews),clone(i.opts)))}},removeAll:function(t){if(t=ge(t)){var e=t.id,i=this.cache()[e];i&&(this.cache()[e]=null,this.init(e,[],i.opts))}},removeMedia:function(t,e){if(!(t=ge(t)))return null;e=intval(e);var i=this.cache()[t.id];if(i){var a=i.previews.splice(e,1),r=a[0][a[0].type].id;return each(t.childNodes,((t,e)=>{if(e.getAttribute&&e.getAttribute("attachment")==r){var i=(geByClass1("_close_btn",e)||{}).tt;return i&&i.destroy&&i.destroy(),!1}})),this.cur().coords=this.getCoords(t),0==i.previews.length?this.init(t,[],i.opts):this.update(t,i.previews),a[0]&&a[0].remove&&a[0].remove(),a}},removeById:function(t,e){if(!(t=ge(t)))return null;for(var i=(this.cache()[t.id]||{}).previews||[],a=0,r=i.length;a<r;++a)if(i[a].type==n.THUMB_TYPE_DOC&&i[a].doc.id==e||i[a].type==n.THUMB_TYPE_PHOTO&&i[a].photo.id==e||i[a].type==n.THUMB_TYPE_VIDEO&&i[a].video.id==e||i[a].type==n.THUMB_TYPE_ALBUM&&i[a].album.id==e||i[a].type==n.THUMB_TYPE_MARKET_ALBUM&&i[a].market_album.id==e)return this.removeMedia(t,a);return null},processThumbs:n.processThumbs,compute:n.compute,getSize:n.getSize,move:n.move,scale:n.scale,crop:n.crop,getRatio:n.getRatio,convert:n.convert,isValidThumbType:n.isValidThumbType}},570272:(t,e,i)=>{var a=i(645621);window.ThumbsEdit=a.ThumbsEdit;try{window.stManager.done(window.jsc("web/thumbs_edit.js"))}catch(t){}}},r={};function n(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={id:t,loaded:!1,exports:{}};return a[t].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=a,t=[],n.O=(e,i,a,r)=>{if(!i){var o=1/0;for(d=0;d<t.length;d++){for(var[i,a,r]=t[d],s=!0,l=0;l<i.length;l++)(!1&r||o>=r)&&Object.keys(n.O).every((t=>n.O[t](i[l])))?i.splice(l--,1):(s=!1,r<o&&(o=r));if(s){t.splice(d--,1);var h=a();void 0!==h&&(e=h)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[i,a,r]},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},i=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,n.t=function(t,a){if(1&a&&(t=this(t)),8&a)return t;if("object"==typeof t&&t){if(4&a&&t.__esModule)return t;if(16&a&&"function"==typeof t.then)return t}var r=Object.create(null);n.r(r);var o={};e=e||[null,i({}),i([]),i(i)];for(var s=2&a&&t;"object"==typeof s&&!~e.indexOf(s);s=i(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>t[e]));return o.default=()=>t,n.d(r,o),r},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.e=()=>Promise.resolve(),n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t={53081:0};n.O.j=e=>0===t[e];var e=(e,i)=>{var a,r,[o,s,l]=i,h=0;for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(l)var d=l(n);for(e&&e(i);h<o.length;h++)r=o[h],n.o(t,r)&&t[r]&&t[r][0](),t[o[h]]=0;return n.O(d)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var o=n.O(void 0,[68592],(()=>n(570272)));o=n.O(o)})();